generator client {
  provider        = "prisma-client-js"
  binaryTargets   = ["native", "debian-openssl-1.0.x"]
  output          = "../generated/prisma"
  previewFeatures = ["extendedWhereUnique", "filterJson", "fullTextSearch", "orderByRelation"]
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model Owner {
  id                 BigInt              @id @default(autoincrement())
  uuid               String              @unique @default(uuid()) @db.VarChar(36)
  name               String              @db.VarChar(100)


  phone              String?             @db.VarChar(20)
  phoneVerified      DateTime?
  password           String              @db.VarChar(255)
  salt               String?             @db.VarChar(255)
  lastLogin          DateTime?
  lastIp             String?             @db.VarChar(45)
  status             UserStatus          @default(ACTIVE)
  timezone           String              @default("UTC") @db.VarChar(50)
  locale             String              @default("en-US") @db.VarChar(10)
  metadata           String?             @db.LongText
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  deletedAt          DateTime?
  schools            School[]
  customers          Customer[]
  createdUsers       User[]              @relation("OwnerCreatedUsers")
  auditLogs          AuditLog[]          @relation("Owner_auditLogs")
  sessions           Session[]           @relation("Owner_sessions")
  permissions        Permission[]
  roles              Role[]
  permissionGroups   PermissionGroup[]
  frontendComponents FrontendComponent[]
  groups             Group[]
  notifications      Notification[]

  @@index([status])
  @@map("owners")
}

model School {
  id                        BigInt                     @id @default(autoincrement())
  uuid                      String                     @unique @default(uuid()) @db.VarChar(36)
  name                      String                     @db.VarChar(255)
  shortName                 String?                    @db.VarChar(50)
  code                      String                     @unique @db.VarChar(20)
  motto                     String?                    @db.VarChar(255)
  about                     String?

  phone                     String                     @db.VarChar(20)
  fax                       String?                    @db.VarChar(20)
  website                   String?                    @db.VarChar(255)
  establishedDate           DateTime?
  principal                 String?                    @db.VarChar(100)
  vicePrincipal             String?                    @db.VarChar(100)
  country                   String                     @db.VarChar(100)
  state                     String                     @db.VarChar(100)
  city                      String                     @db.VarChar(100)
  address                   String                     @db.VarChar(255)
  postalCode                String?                    @db.VarChar(20)
  latitude                  Float?
  longitude                 Float?
  logo                      String?                    @db.VarChar(255)
  coverImage                String?                    @db.VarChar(255)
  themeColor                String?                    @db.VarChar(20)
  timezone                  String                     @default("UTC") @db.VarChar(50)
  locale                    String                     @default("en-US") @db.VarChar(10)
  currency                  String                     @default("USD") @db.VarChar(3)
  status                    SchoolStatus               @default(ACTIVE)
  ownerId                   BigInt
  subscriptionId            BigInt?                   @unique(map: "school_subscription_unique")
  superAdminUserId          BigInt?
  academicSessionId         BigInt?
  currentTermId             BigInt?
  createdBy                 BigInt?
  updatedBy                 BigInt?
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  deletedAt                 DateTime?
  settings                  Json?
  tenantId                  String?                    @unique @db.VarChar(64)
  owner                     Owner                      @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  subscription              SchoolSubscription?        @relation("School_primarySubscription", fields: [subscriptionId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  superAdminUser            User?                      @relation("School_superAdminUser", fields: [superAdminUserId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users                     User[]
  classes                   Class[]
  branches                  Branch[]
  departments               Department[]
  subjects                  Subject[]
  courses                   Course[]
  branchManagerAssignments  BranchManagerAssignment[]
  courseManagerAssignments  CourseManagerAssignment[]
  academicSessions          AcademicSession[]
  terms                     Term[]
  facilities                Facility[]
  inventoryItems            InventoryItem[]
  vehicles                  Vehicle[]
  notices                   Notice[]
  events                    Event[]
  exams                     Exam[]
  feeStructures             FeeStructure[]
  payments                  Payment[]
  payrolls                  Payroll[]
  expenses                  Expense[]
  auditLogs                 AuditLog[]
  students                  Student[]
  teachers                  Teacher[]
  staff                     Staff[]
  parents                   Parent[]
  sections                  Section[]
  timetables                Timetable[]
  grades                    Grade[]
  excelGradeHeaders         ExcelGradeHeader[]
  examTimetables            ExamTimetable[]
  attendances               Attendance[]
  feeItems                  FeeItem[]
  paymentItems              PaymentItem[]
  books                     Book[]
  bookIssues                BookIssue[]
  inventoryCategories       InventoryCategory[]
  inventoryLogs             InventoryLog[]
  facilityBookings          FacilityBooking[]
  routes                    Route[]
  routeStops                RouteStop[]
  trips                     Trip[]
  studentTransports         StudentTransport[]
  transportAttendances      TransportAttendance[]
  messages                  Message[]
  documents                 Document[]
  conversations             Conversation[]
  enrollments               StudentEnrollment[]
  conversationParticipants  ConversationParticipant[]
  messageAttachments        MessageAttachment[]
  messageReactions          MessageReaction[]
  messageForwards           MessageForward[]
  messageAnalytics          MessageAnalytics[]
  conversationAnalytics     ConversationAnalytics[]
  messageNotifications      MessageNotification[]
  conversationNotifications ConversationNotification[]
  conversationSettings      ConversationSetting[]
  messageThreads            MessageThread[]
  messagePolls              MessagePoll[]
  assignments               Assignment[]
  assignmentAttachments     AssignmentAttachment[]
  assignmentSubmissions     AssignmentSubmission[]
  submissionAttachments     SubmissionAttachment[]
  assignmentParentNotes     AssignmentParentNote[]
  suggestionComplaints      SuggestionComplaint[]
  schoolSettings            SchoolSetting[]
  permissions               Permission[]
  roles                     Role[]
  permissionGroups          PermissionGroup[]
  frontendComponents        FrontendComponent[]
  groups                    Group[]
  customerEvents            CustomerEvent[]
  studentEvents             StudentEvent[]
  customerPipelineStages    CustomerPipelineStage[]
  customers                 Customer[]
  notifications             Notification[]
  notificationTemplates     NotificationTemplate[]
  notificationRules         NotificationRule[]
  incomes                   Income[]
  classTeachers             ClassToTeacher[]
  teacherClassSubjects      TeacherClassSubject[]
  bookDistributions         BookDistribution[]
  reportSchedules           ReportSchedule[]
  reportExports             ReportExport[]
  customReports             CustomReport[]
  gradeApprovals            GradeApproval[]
  systemSettings            SystemSetting[]
  packages                  Package[]
  rolePermissions           RolePermission[]
  roleInheritances          RoleInheritance[]
  userPermissions           UserPermission[]
  userRoleAssignments       UserRoleAssignment[]
  accessControlLists        AccessControlList[]
  permissionGroupItems      PermissionGroupItem[]
  componentPermissions      ComponentPermission[]
  policies                  Policy[]
  policyAssignments         PolicyAssignment[]
  attributeRules            AttributeRule[]
  attributeAssignments      AttributeAssignment[]
  permissionAssignments     PermissionAssignment[]
  classToSubjects           ClassToSubject[]
  groupToUsers              GroupToUser[]
  participantLastReadMessages Participant_lastReadMessage[]
  subjectToTeachers         SubjectToTeacher[]
  googleDriveIntegrations   GoogleDriveIntegration[]
  subscriptions             SchoolSubscription[]       @relation("School_allSubscriptions")
  logDailyRollups           LogDailyRollup[]

  @@index([ownerId])
  @@index([code])
  @@index([status])
  @@index([country, state, city])
  @@index([subscriptionId])
  @@index([superAdminUserId])
  @@unique([subscriptionId])
  @@map("schools")
}

model Branch {
  id                    BigInt                      @id @default(autoincrement())
  uuid                  String                      @unique @default(uuid()) @db.VarChar(36)
  name                  String                      @db.VarChar(100)
  code                  String                      @db.VarChar(30)
  shortName             String?                     @db.VarChar(50)
  type                  String?                     @db.VarChar(50)
  description           String?
  email                 String?                     @db.VarChar(150)
  phone                 String?                     @db.VarChar(20)
  alternatePhone        String?                     @db.VarChar(20)
  addressLine1          String?                     @db.VarChar(255)
  addressLine2          String?                     @db.VarChar(255)
  city                  String?                     @db.VarChar(100)
  state                 String?                     @db.VarChar(100)
  country               String?                     @db.VarChar(100)
  postalCode            String?                     @db.VarChar(20)
  latitude              Float?
  longitude             Float?
  timezone              String                      @default("UTC") @db.VarChar(50)
  isMain                Boolean                     @default(false)
  status                BranchStatus                @default(ACTIVE)
  openedDate            DateTime?
  metadata              Json?
  schoolId              BigInt
  createdBy             BigInt
  updatedBy             BigInt?
  createdAt             DateTime                    @default(now())
  updatedAt             DateTime                    @updatedAt
  deletedAt             DateTime?
  school                School                      @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  managerAssignments    BranchManagerAssignment[]
  users                 User[]
  academicSessions      AcademicSession[]
  terms                 Term[]
  departments           Department[]
  courses               Course[]
  courseManagerAssignments CourseManagerAssignment[]
  classes               Class[]
  subjects              Subject[]
  timetables            Timetable[]
  teachers              Teacher[]
  students              Student[]
  studentEnrollments    StudentEnrollment[]
  parents               Parent[]
  staffMembers          Staff[]
  sections              Section[]
  exams                 Exam[]
  grades                Grade[]
  examTimetables        ExamTimetable[]
  attendances           Attendance[]
  feeStructures         FeeStructure[]
  feeItems              FeeItem[]
  payments              Payment[]
  paymentItems          PaymentItem[]
  payrolls              Payroll[]
  expenses              Expense[]
  books                 Book[]
  bookIssues            BookIssue[]
  inventoryCategories   InventoryCategory[]
  inventoryItems        InventoryItem[]
  inventoryLogs         InventoryLog[]
  incomes               Income[]
  facilities            Facility[]
  facilityBookings      FacilityBooking[]
  vehicles              Vehicle[]
  routes                Route[]
  routeStops            RouteStop[]
  trips                 Trip[]
  studentTransports     StudentTransport[]
  transportAttendances  TransportAttendance[]
  notices               Notice[]
  events                Event[]
  conversations         Conversation[]
  conversationParticipants ConversationParticipant[]
  messages              Message[]
  messageThreads        MessageThread[]
  messageAttachments    MessageAttachment[]
  messageReactions      MessageReaction[]
  messageForwards       MessageForward[]
  messagePolls          MessagePoll[]
  conversationSettings  ConversationSetting[]
  messageNotifications  MessageNotification[]
  conversationNotifications ConversationNotification[]
  messageAnalytics      MessageAnalytics[]
  conversationAnalytics ConversationAnalytics[]
  documents             Document[]
  auditLogs             AuditLog[]
  schoolSettings        SchoolSetting[]
  schoolSubscriptions   SchoolSubscription[]
  assignments           Assignment[]
  assignmentAttachments AssignmentAttachment[]
  assignmentSubmissions AssignmentSubmission[]
  submissionAttachments SubmissionAttachment[]
  assignmentParentNotes AssignmentParentNote[]
  suggestionComplaints  SuggestionComplaint[]
  customers             Customer[]
  customerPipelineStages CustomerPipelineStage[]
  customerEvents        CustomerEvent[]
  studentEvents         StudentEvent[]
  notifications         Notification[]
  notificationRecipients NotificationRecipient[] @relation("BranchNotificationRecipients")
  notificationAttachments NotificationAttachment[] @relation("BranchNotificationAttachments")
  notificationDeliveries NotificationDelivery[] @relation("BranchNotificationDeliveries")
  notificationTemplates NotificationTemplate[]
  notificationRules     NotificationRule[]
  groups                Group[]
  classTeachers         ClassToTeacher[]
  teacherClassSubjects  TeacherClassSubject[]
  bookDistributions     BookDistribution[]
  gradeApprovals        GradeApproval[]
  sessions              Session[] @relation("BranchSessions")

  @@index([schoolId])
  @@index([status])
  @@unique([schoolId, code])
  @@map("branches")
}

model User {
  id                              BigInt                     @id @default(autoincrement())
  uuid                            String                     @unique @default(uuid()) @db.VarChar(36)
  username                        String                     @unique @db.VarChar(50)

  // Personal Information
  tazkiraNo                       String?                    @db.VarChar(50)
  phone                           String?                    @db.VarChar(20)
  phoneVerified                   DateTime?
  password                        String?                    @db.VarChar(255)
  salt                            String?                    @db.VarChar(255)
  firstName                       String                     @db.VarChar(50)
  middleName                      String?                    @db.VarChar(50)
  lastName                        String                     @db.VarChar(50)
  fatherName                      String?                    @db.VarChar(100)          // HR: Father name (required for some roles)
  dariName                        String?                    @db.VarChar(100)
  displayName                     String?                    @db.VarChar(100)
  gender                          Gender?
  birthDate                       DateTime?
  avatar                          String?                    @db.VarChar(255)
  coverImage                      String?                    @db.VarChar(255)
  bio                             String?                    @db.VarChar(255)
  
  // Contact Information
  email                           String?                    @db.VarChar(255)          // HR: Email field
  address                         String?                    @db.VarChar(255)          // HR: Address field
  
  // Professional Information
  role                            UserRole
  designation                     String?                    @db.VarChar(100)          // HR: Job title/designation
  employeeId                      String?                    @db.VarChar(50)           // HR: Employee ID
  totalExperience                 Int?                       // HR: Total years of experience
  relevantExperience              String?                    @db.Text                  // HR: Relevant experience details
  shift                           String?                    @db.VarChar(50)           // HR: Work shift (morning/evening/night)
  workTime                        String?                    @db.VarChar(50)           // HR: Work time (FullTime/PartTime)
  
  // Teaching Specific Fields
  subjectsCanTeach                Json?                      // HR: Array of subjects teacher can teach
  qualification                   String?                    @db.Text                  // HR: Educational qualification
  specialization                  String?                    @db.VarChar(255)          // HR: Specialization area
  isClassTeacher                  Boolean?                   // HR: Whether teacher is class teacher
  
  // Contract Information
  contractStartDate               DateTime?                  // HR: Contract start date
  contractEndDate                 DateTime?                  // HR: Contract end date
  salaryType                      String?                    @db.VarChar(50)           // HR: Salary type (fixed/percentage/hourly)
  salaryAmount                    Decimal?                   // HR: Salary amount
  salaryCurrency                  String?                    @db.VarChar(3)            // HR: Salary currency
  
  // System Fields
  status                          UserStatus                 @default(ACTIVE)
  lastLogin                       DateTime?
  lastIp                          String?                    @db.VarChar(45)
  timezone                        String                     @default("UTC") @db.VarChar(50)
  locale                          String                     @default("en-US") @db.VarChar(10)
  metadata                        String?                    @db.LongText              // HR: Extended metadata for role-specific data
  schoolId                        BigInt?
  branchId                        BigInt?
  courseId                        BigInt?                    // HR: Course ID for course-specific users
  
  // Audit Fields
  createdByOwnerId                BigInt
  createdBy                       BigInt?
  updatedBy                       BigInt?
  createdAt                       DateTime                   @default(now())
  updatedAt                       DateTime                   @updatedAt
  deletedAt                       DateTime?
  school                          School?                    @relation(fields: [schoolId], references: [id], onDelete: SetNull, onUpdate: NoAction)
  branch                          Branch?                    @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByOwner                  Owner                      @relation("OwnerCreatedUsers", fields: [createdByOwnerId], references: [id], onDelete: Cascade)
  teacher                         Teacher?                   @relation("Teacher_user")
  student                         Student?
  staff                           Staff?
  parent                          Parent?
  sentMessages                    Message[]                  @relation("SentMessages")
  receivedMessages                Message[]                  @relation("ReceivedMessages")
  conversationParticipants        ConversationParticipant[]
  messageReactions                MessageReaction[]
  messageForwards                 MessageForward[]           @relation("MessageForward_forwardedByUser")
  forwardedMessages               MessageForward[]           @relation("MessageForward_forwardedToUser")
  messageAnalytics                MessageAnalytics[]
  conversationAnalytics           ConversationAnalytics[]
  messageNotifications            MessageNotification[]
  conversationNotifications       ConversationNotification[]
  conversationSettings            ConversationSetting[]      @relation("ConversationSetting_createdByUser")
  conversationSettingsUpdated     ConversationSetting[]      @relation("ConversationSetting_updatedByUser")
  messageAttachments              MessageAttachment[]        @relation("MessageAttachment_createdByUser")
  messageAttachmentsUpdated       MessageAttachment[]        @relation("MessageAttachment_updatedByUser")
  conversationsCreated            Conversation[]             @relation("Conversation_createdByUser")
  conversationsUpdated            Conversation[]             @relation("Conversation_updatedByUser")
  conversationParticipantsCreated ConversationParticipant[]  @relation("ConversationParticipant_createdByUser")
  conversationParticipantsUpdated ConversationParticipant[]  @relation("ConversationParticipant_updatedByUser")
  lastReadMessages                ConversationParticipant[]  @relation("Participant_lastReadMessage")
  messagesCreated                 Message[]                  @relation("Message_createdByUser")
  messagesUpdated                 Message[]                  @relation("Message_updatedByUser")
  messageThreadsCreated           MessageThread[]            @relation("MessageThread_createdByUser")
  messageThreadsUpdated           MessageThread[]            @relation("MessageThread_updatedByUser")
  messagePollsCreated             MessagePoll[]              @relation("MessagePoll_createdByUser")
  sessions                        Session[]
  auditLogs                       AuditLog[]
  assignmentsCreated              Assignment[]               @relation("Assignment_createdByUser")
  assignmentsUpdated              Assignment[]               @relation("Assignment_updatedByUser")
  assignmentsTeaching             Assignment[]               @relation("Assignment_teacher")
  documentsUpdated                Document[]                 @relation("Document_updatedByUser")
  documentsCreated                Document[]                 @relation("Document_createdByUser")
  noticesCreated                  Notice[]                   @relation("Notice_createdByUser")
  noticesUpdated                  Notice[]                   @relation("Notice_updatedByUser")
  transportAttendancesCreated     TransportAttendance[]      @relation("TransportAttendance_createdByUser")
  transportAttendancesUpdated     TransportAttendance[]      @relation("TransportAttendance_updatedByUser")
  studentTransportsCreated        StudentTransport[]         @relation("StudentTransport_createdByUser")
  studentTransportsUpdated        StudentTransport[]         @relation("StudentTransport_updatedByUser")
  tripsCreated                    Trip[]                     @relation("Trip_createdByUser")
  tripsUpdated                    Trip[]                     @relation("Trip_updatedByUser")
  routesUpdated                   Route[]                    @relation("Route_updatedByUser")
  routeStopsCreated               RouteStop[]                @relation("RouteStop_createdByUser")
  routeStopsUpdated               RouteStop[]                @relation("RouteStop_updatedByUser")
  facilityBookingsCreated         FacilityBooking[]          @relation("FacilityBooking_createdByUser")
  facilityBookingsUpdated         FacilityBooking[]          @relation("FacilityBooking_updatedByUser")
  vehiclesDriver                  Vehicle[]                  @relation("VehicleDriver")
  vehiclesAttendant               Vehicle[]                  @relation("VehicleAttendant")
  vehiclesCreated                 Vehicle[]                  @relation("Vehicle_createdByUser")
  vehiclesUpdated                 Vehicle[]                  @relation("Vehicle_updatedByUser")
  facilitiesCreated               Facility[]                 @relation("Facility_createdByUser")
  facilitiesUpdated               Facility[]                 @relation("Facility_updatedByUser")
  facilityBookingsBooked          FacilityBooking[]          @relation("FacilityBooking_bookedBy")
  inventoryItemsCreated           InventoryItem[]            @relation("InventoryItem_createdByUser")
  inventoryItemsUpdated           InventoryItem[]            @relation("InventoryItem_updatedByUser")
  inventoryLogsCreated            InventoryLog[]             @relation("InventoryLog_createdByUser")
  inventoryLogsUpdated            InventoryLog[]             @relation("InventoryLog_updatedByUser")
  booksCreated                    Book[]                     @relation("Book_createdByUser")
  booksUpdated                    Book[]                     @relation("Book_updatedByUser")
  bookIssuesCreated               BookIssue[]                @relation("BookIssue_createdByUser")
  bookIssuesUpdated               BookIssue[]                @relation("BookIssue_updatedByUser")
  inventoryCategoriesCreated      InventoryCategory[]        @relation("InventoryCategory_createdByUser")
  inventoryCategoriesUpdated      InventoryCategory[]        @relation("InventoryCategory_updatedByUser")
  routesCreated                   Route[]                    @relation("Route_createdByUser")
  feeStructuresCreated            FeeStructure[]             @relation("FeeStructureCreatedBy")
  feeStructuresUpdated            FeeStructure[]             @relation("FeeStructureUpdatedBy")
  feeItemsCreated                 FeeItem[]                  @relation("FeeItem_createdByUser")
  feeItemsUpdated                 FeeItem[]                  @relation("FeeItem_updatedByUser")
  paymentsCreated                 Payment[]                  @relation("PaymentCreatedBy")
  paymentsUpdated                 Payment[]                  @relation("PaymentUpdatedBy")
  payrollsCreated                 Payroll[]                  @relation("Payroll_createdByUser")
  payrollsUpdated                 Payroll[]                  @relation("Payroll_updatedByUser")
  expensesCreated                 Expense[]                  @relation("Expense_createdByUser")
  expensesUpdated                 Expense[]                  @relation("Expense_updatedByUser")
  gradesCreated                   Grade[]                    @relation("Grade_createdByUser")
  gradesUpdated                   Grade[]                    @relation("Grade_updatedByUser")
  examTimetablesCreated           ExamTimetable[]            @relation("ExamTimetable_createdByUser")
  examTimetablesUpdated           ExamTimetable[]            @relation("ExamTimetable_updatedByUser")
  attendancesCreated              Attendance[]               @relation("Attendance_createdByUser")
  attendancesUpdated              Attendance[]               @relation("Attendance_updatedByUser")
  userPermissions                 UserPermission[]
  userRoleAssignments             UserRoleAssignment[]
  componentPermissions            ComponentPermission[]
  permissionsCreated              Permission[]               @relation("Permission_createdByUser")
  permissionsUpdated              Permission[]               @relation("Permission_updatedByUser")
  rolesCreated                    Role[]                     @relation("Role_createdByUser")
  rolesUpdated                    Role[]                     @relation("Role_updatedByUser")
  rolePermissionsCreated          RolePermission[]           @relation("RolePermission_createdByUser")
  roleInheritancesCreated         RoleInheritance[]          @relation("RoleInheritance_createdByUser")
  userPermissionsCreated          UserPermission[]           @relation("UserPermission_createdByUser")
  userRoleAssignmentsAssigned     UserRoleAssignment[]       @relation("UserRoleAssignment_assignedByUser")
  accessControlListsCreated       AccessControlList[]        @relation("AccessControlList_createdByUser")
  customReportsCreated            CustomReport[]             @relation("CustomReport_createdByUser")
  permissionGroupsCreated         PermissionGroup[]          @relation("PermissionGroup_createdByUser")
  permissionGroupsUpdated         PermissionGroup[]          @relation("PermissionGroup_updatedByUser")
  permissionGroupItemsCreated     PermissionGroupItem[]      @relation("PermissionGroupItem_createdByUser")
  frontendComponentsCreated       FrontendComponent[]        @relation("FrontendComponent_createdByUser")
  frontendComponentsUpdated       FrontendComponent[]        @relation("FrontendComponent_updatedByUser")
  componentPermissionsCreated     ComponentPermission[]      @relation("ComponentPermission_createdByUser")
  policiesCreated                 Policy[]                   @relation("Policy_createdByUser")
  policiesUpdated                 Policy[]                   @relation("Policy_updatedByUser")
  policyAssignmentsAssigned       PolicyAssignment[]         @relation("PolicyAssignment_assignedByUser")
  attributeRulesCreated           AttributeRule[]            @relation("AttributeRule_createdByUser")
  attributeRulesUpdated           AttributeRule[]            @relation("AttributeRule_updatedByUser")
  attributeAssignmentsAssigned    AttributeAssignment[]      @relation("AttributeAssignment_assignedByUser")
  customerEventsCreated           CustomerEvent[]            @relation("CustomerEvent_createdByUser")
  studentEventsCreated            StudentEvent[]             @relation("StudentEvent_createdByUser")
  assignmentParentNoteResponses   AssignmentParentNote[]     @relation("AssignmentParentNote_teacherResponder")
  suggestionComplaintsReceived    SuggestionComplaint[]      @relation("SuggestionComplaint_recipient")
  suggestionComplaintsResponded   SuggestionComplaint[]      @relation("SuggestionComplaint_responder")
  customersCreated                Customer[]                 @relation("CustomerCreatedBy")
  customersUpdated                Customer[]                 @relation("CustomerUpdatedBy")
  permissionAssignmentsAssigned   PermissionAssignment[]     @relation("PermissionAssignment_assignedByUser")
  groupsCreated                   Group[]                    @relation("Group_createdByUser")
  groupsUpdated                   Group[]                    @relation("Group_updatedByUser")
  sentNotifications               Notification[]             @relation("Notification_sender")
  notificationRecipients          NotificationRecipient[]
  notificationTemplatesCreated    NotificationTemplate[]     @relation("NotificationTemplate_createdByUser")
  notificationTemplatesUpdated    NotificationTemplate[]     @relation("NotificationTemplate_updatedByUser")
  notificationRulesCreated        NotificationRule[]         @relation("NotificationRule_createdByUser")
  notificationRulesUpdated        NotificationRule[]         @relation("NotificationRule_updatedByUser")
  incomesCreated                  Income[]                   @relation("Income_createdByUser")
  incomesUpdated                  Income[]                   @relation("Income_updatedByUser")
  permissionAssignments           PermissionAssignment[]
  groups                          Group[]
  enrollmentsCreated              StudentEnrollment[]            @relation("StudentEnrollment_createdByUser")
  enrollmentsUpdated              StudentEnrollment[]            @relation("StudentEnrollment_updatedByUser")
  googleDriveIntegration          GoogleDriveIntegration?
  bookDistributionsCreated        BookDistribution[]             @relation("BookDistribution_createdByUser")
  bookDistributionsUpdated        BookDistribution[]             @relation("BookDistribution_updatedByUser")
  gradeApprovalsCreated           GradeApproval[]                @relation("GradeApproval_createdByUser")
  gradeApprovalsUpdated           GradeApproval[]                @relation("GradeApproval_updatedByUser")
  superAdminSchools               School[]                       @relation("School_superAdminUser")
  packagesCreated                 Package[]                      @relation("Package_createdByUser")
  branchManagerRoles              BranchManagerAssignment[]       @relation("BranchManager_manager")
  branchManagerAssignmentsMade    BranchManagerAssignment[]       @relation("BranchManager_assignedByUser")
  courseManagerRoles              CourseManagerAssignment[]       @relation("CourseManager_manager")
  courseManagerAssignmentsMade    CourseManagerAssignment[]       @relation("CourseManager_assignedByUser")
  centersManagedDirectly          Course[]                        @relation("CourseCenterManager")

  @@index([username])
  @@index([phone])
  @@index([email])                         // HR: Email index for uniqueness and search
  @@index([role])
  @@index([status])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])                      // HR: Course ID index
  @@index([employeeId])                    // HR: Employee ID index
  @@index([contractStartDate, contractEndDate]) // HR: Contract date range index
  @@index([salaryType])                    // HR: Salary type index
  @@index([totalExperience])                // HR: Experience index
  @@index([createdByOwnerId])
  @@unique([email, schoolId])              // HR: Unique email per school
  @@map("users")
}

model AcademicSession {
  id          BigInt    @id @default(autoincrement())
  uuid        String    @unique @default(uuid()) @db.VarChar(36)
  name        String    @db.VarChar(100)
  startDate   DateTime
  endDate     DateTime
  isCurrent   Boolean   @default(false)
  description String?
  schoolId    BigInt
  branchId    BigInt?
  createdBy   BigInt
  updatedBy   BigInt?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt         DateTime?
  school            School              @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?             @relation(fields: [branchId], references: [id], onDelete: SetNull)
  terms             Term[]
  enrollments       StudentEnrollment[]
  feeStructures     FeeStructure[]
  teacherAssignments TeacherClassSubject[]
  attendances       Attendance[]
  payments          Payment[]

  @@index([schoolId])
  @@index([branchId])
  @@index([isCurrent])
  @@index([startDate, endDate])
  @@map("academic_sessions")
}

model Term {
  id                BigInt          @id @default(autoincrement())
  uuid              String          @unique @default(uuid()) @db.VarChar(36)
  name              String          @db.VarChar(100)
  type              TermType
  startDate         DateTime
  endDate           DateTime
  isCurrent         Boolean         @default(false)
  academicSessionId BigInt
  schoolId          BigInt
  branchId          BigInt?
  createdBy         BigInt
  updatedBy         BigInt?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  deletedAt         DateTime?
  academicSession   AcademicSession @relation(fields: [academicSessionId], references: [id], onDelete: Cascade)
  school            School          @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?         @relation(fields: [branchId], references: [id], onDelete: SetNull)
  exams             Exam[]          @relation("Term_exams")

  @@index([academicSessionId])
  @@index([schoolId])
  @@index([branchId])
  @@index([isCurrent])
  @@index([startDate, endDate])
  @@map("terms")
}

model Department {
  id          BigInt    @id @default(autoincrement())
  uuid        String    @unique @default(uuid()) @db.VarChar(36)
  name        String    @db.VarChar(100)
  code        String    @unique @db.VarChar(20)
  description String?
  headId      BigInt?
  schoolId    BigInt
  branchId    BigInt?
  createdBy   BigInt
  updatedBy   BigInt?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  school      School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch      Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  subjects    Subject[]
  staff       Staff[]
  teachers    Teacher[]

  @@index([schoolId])
  @@index([branchId])
  @@index([code])
  @@map("departments")
}

model Course {
  id                BigInt        @id @default(autoincrement())
  uuid              String        @unique @default(uuid()) @db.VarChar(36)
  name              String        @db.VarChar(150)
  code              String        @db.VarChar(30)
  description       String?       @db.Text
  summary           String?       @db.Text
  focusArea         String?       @db.VarChar(100)
  centerType        String?       @db.VarChar(50)
  targetAudience    String?       @db.VarChar(50)
  isActive          Boolean       @default(true)
  isAccredited      Boolean       @default(false)
  enrollmentOpen    Boolean       @default(true)
  schoolId          BigInt
  branchId          BigInt?       @map("branch_id")
  centerManagerId   BigInt?
  operatingHours    String?       @db.VarChar(100)
  scheduleType      String?       @db.VarChar(30)
  budget            Decimal?      @db.Decimal(12, 2)
  resources         Json?
  policies          Json?
  createdBy         BigInt
  updatedBy         BigInt?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  deletedAt         DateTime?
  school            School        @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?       @relation(fields: [branchId], references: [id], onDelete: SetNull)
  centerManager     User?         @relation("CourseCenterManager", fields: [centerManagerId], references: [id], onDelete: SetNull)
  classes           Class[]
  managerAssignments CourseManagerAssignment[]
  subjects          Subject[]
  timetables        Timetable[]
  students          Student[]
  studentEnrollments StudentEnrollment[]
  sections          Section[]
  exams             Exam[]
  grades            Grade[]
  examTimetables    ExamTimetable[]
  attendances       Attendance[]
  feeStructures     FeeStructure[]
  feeItems          FeeItem[]
  payments          Payment[]
  paymentItems      PaymentItem[]
  assignments       Assignment[]
  assignmentAttachments AssignmentAttachment[]
  assignmentSubmissions AssignmentSubmission[]
  submissionAttachments SubmissionAttachment[]
  assignmentParentNotes AssignmentParentNote[]
  suggestionComplaints SuggestionComplaint[]
  studentEvents     StudentEvent[]
  classTeachers     ClassToTeacher[]
  teacherClassSubjects TeacherClassSubject[]
  bookDistributions BookDistribution[]
  gradeApprovals    GradeApproval[]
  sessions          Session[] @relation("CourseSessions")
  notificationRecipients NotificationRecipient[] @relation("CourseNotificationRecipients")
  notificationAttachments NotificationAttachment[] @relation("CourseNotificationAttachments")
  notificationDeliveries NotificationDelivery[] @relation("CourseNotificationDeliveries")

  @@index([schoolId])
  @@index([branchId], map: "courses_branch_id_idx")
  @@index([centerManagerId])
  @@index([centerType])
  @@index([isActive])
  @@unique([schoolId, code])
  @@map("courses")
}

model BranchManagerAssignment {
  id           BigInt    @id @default(autoincrement())
  uuid         String    @unique @default(uuid()) @db.VarChar(36)
  schoolId     BigInt
  branchId     BigInt
  userId       BigInt
  assignedBy   BigInt?
  assignedAt   DateTime  @default(now())
  revokedAt    DateTime?
  metadata     Json?
  school       School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch       Branch    @relation(fields: [branchId], references: [id], onDelete: Cascade)
  manager      User      @relation("BranchManager_manager", fields: [userId], references: [id], onDelete: Cascade)
  assignedByUser User?   @relation("BranchManager_assignedByUser", fields: [assignedBy], references: [id], onDelete: SetNull)

  @@unique([branchId, userId], map: "branch_manager_unique_assignment")
  @@index([schoolId])
  @@index([branchId])
  @@index([userId])
  @@map("branch_manager_assignments")
}

model CourseManagerAssignment {
  id           BigInt    @id @default(autoincrement())
  uuid         String    @unique @default(uuid()) @db.VarChar(36)
  schoolId     BigInt
  branchId     BigInt?
  courseId     BigInt
  userId       BigInt
  assignedBy   BigInt?
  assignedAt   DateTime  @default(now())
  revokedAt    DateTime?
  metadata     Json?
  school       School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch       Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course       Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  manager      User      @relation("CourseManager_manager", fields: [userId], references: [id], onDelete: Cascade)
  assignedByUser User?   @relation("CourseManager_assignedByUser", fields: [assignedBy], references: [id], onDelete: SetNull)

  @@unique([courseId, userId], map: "course_manager_unique_assignment")
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([userId])
  @@map("course_manager_assignments")
}

model Class {
  id             BigInt         @id @default(autoincrement())
  uuid           String         @unique @default(uuid()) @db.VarChar(36)
  name           String         @db.VarChar(100)
  code           String         @db.VarChar(20)
  level          Int
  section        String?        @db.VarChar(10)
  roomNumber     String?        @db.VarChar(20)
  capacity       Int
  classTeacherId BigInt?
  supervisorId   BigInt?        // نگران صنف (Class Supervisor) - Only 1 supervisor per class
  expectedFees   Decimal?       @db.Decimal(10, 2)
  shift          String?        @default("morning") @db.VarChar(20)
  gender         String?        @default("boys") @db.VarChar(20)
  isActive       Boolean        @default(true)
  schoolId       BigInt
  branchId       BigInt?
  courseId       BigInt?
  createdBy      BigInt
  updatedBy      BigInt?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  deletedAt      DateTime?
  school                School         @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch                Branch?        @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course                Course?        @relation(fields: [courseId], references: [id], onDelete: SetNull)
  classTeacher          Teacher?       @relation("ClassTeacher", fields: [classTeacherId], references: [id], onDelete: SetNull)
  supervisor            Teacher?       @relation("ClassSupervisor", fields: [supervisorId], references: [id], onDelete: SetNull)
  teachers              ClassToTeacher[]
  students              Student[]
  subjects              Subject[]
  timetables            Timetable[]
  exams                 Exam[]
  feeStructures         FeeStructure[]
  sections              Section[]
  assignments           Assignment[]
  attendances           Attendance[]
  teacherClassSubjects  TeacherClassSubject[]
  enrollments           StudentEnrollment[]
  gradeApprovals        GradeApproval[]
  excelGradeHeaders     ExcelGradeHeader[]

  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([code])
  @@index([level, section])
  @@index([classTeacherId])
  @@index([supervisorId])
  @@map("classes")
}

model Subject {
  id                  BigInt          @id @default(autoincrement())
  uuid                String          @unique @default(uuid()) @db.VarChar(36)
  name                String          @db.VarChar(100)
  code                String          @db.VarChar(20)
  description         String?
  creditHours         Int
  isElective          Boolean         @default(false)
  isActive            Boolean         @default(true)
  weeklyHoursPerClass Json?           @db.Json
  departmentId        BigInt?
  schoolId            BigInt
  branchId            BigInt?
  courseId            BigInt?
  createdBy           BigInt
  updatedBy           BigInt?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  deletedAt           DateTime?
  department            Department?     @relation(fields: [departmentId], references: [id], onDelete: SetNull)
  school                School          @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch                Branch?         @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course                Course?         @relation(fields: [courseId], references: [id], onDelete: SetNull)
  classes               Class[]
  teachers              Teacher[]
  timetables            Timetable[]
  exams                 Exam[]
  assignments           Assignment[]
  books                 Book[]
  grades                Grade[]
  examTimetables        ExamTimetable[]
  attendances           Attendance[]
  teacherClassSubjects  TeacherClassSubject[]
  bookDistributions     BookDistribution[]

  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([code])
  @@index([departmentId])
  @@map("subjects")
}

model Timetable {
  id         BigInt    @id @default(autoincrement())
  uuid       String    @unique @default(uuid()) @db.VarChar(36)
  day        Int
  period     Int
  startTime  DateTime  @db.Time(6)
  endTime    DateTime  @db.Time(6)
  classId    BigInt
  subjectId  BigInt
  teacherId  BigInt
  roomNumber String?   @db.VarChar(20)
  schoolId   BigInt
  branchId   BigInt?
  courseId   BigInt?
  createdBy  BigInt
  updatedBy  BigInt?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  deletedAt  DateTime?
  class      Class     @relation(fields: [classId], references: [id], onDelete: Cascade)
  subject    Subject   @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  school     School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch     Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course     Course?   @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@unique([classId, day, period])
  @@index([classId])
  @@index([subjectId])
  @@index([teacherId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([day, period])
  @@map("timetables")
}

model Teacher {
  id                    BigInt       @id @default(autoincrement())
  uuid                  String       @unique @default(uuid()) @db.VarChar(36)
  userId                BigInt       @unique
  employeeId            String       @unique @db.VarChar(50)
  departmentId          BigInt?
  qualification         String?      @db.VarChar(255)
  specialization        String?      @db.VarChar(255)
  joiningDate           DateTime?
  experience            Int?         @default(0)
  salary                Decimal?     @db.Decimal(10, 2)
  isClassTeacher        Boolean      @default(false)
  schoolId              BigInt
  branchId              BigInt?
  createdBy             BigInt
  updatedBy             BigInt?
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt
  deletedAt             DateTime?
  user                  User         @relation("Teacher_user", fields: [userId], references: [id], onDelete: Cascade)
  department            Department?  @relation(fields: [departmentId], references: [id], onDelete: SetNull)
  school                School       @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch                Branch?      @relation(fields: [branchId], references: [id], onDelete: SetNull)
  classesAsClassTeacher Class[]      @relation("ClassTeacher")
  classesAsSupervisor   Class[]      @relation("ClassSupervisor")
  classes               ClassToTeacher[]
  subjects              Subject[]
  attendances           Attendance[]
  documents             Document[]
  teacherClassSubjects  TeacherClassSubject[]

  @@index([userId])
  @@index([employeeId])
  @@index([schoolId])
  @@index([departmentId])
  @@map("teachers")
}

model Student {
  id                      BigInt                 @id @default(autoincrement())
  uuid                    String                 @unique @default(uuid()) @db.VarChar(36)
  userId                  BigInt                 @unique
  admissionNo             String                 @unique @db.VarChar(50)
  rollNo                  String?                @db.VarChar(20)
  cardNo                  String?                @db.VarChar(50)
  classId                 BigInt?
  sectionId               BigInt?
  parentId                BigInt?
  localLastName           String?                @db.VarChar(50)
  admissionDate           DateTime?
  bloodGroup              String?                @db.VarChar(5)
  nationality             String?                @db.VarChar(50)
  religion                String?                @db.VarChar(50)
  caste                   String?                @db.VarChar(50)
  tazkiraNo               String?                @db.VarChar(50)
  bankAccountNo           String?                @db.VarChar(30)
  bankName                String?                @db.VarChar(100)
  previousSchool          String?                @db.VarChar(255)
  
  // Origin Address (Where the student is from)
  originAddress           String?                @db.VarChar(255)
  originCity              String?                @db.VarChar(100)
  originState             String?                @db.VarChar(100)
  originProvince          String?                @db.VarChar(100)
  originCountry           String?                @db.VarChar(100)
  originPostalCode        String?                @db.VarChar(20)
  
  // Current Residence Address (Where the student currently lives)
  currentAddress          String?                @db.VarChar(255)
  currentCity             String?                @db.VarChar(100)
  currentState            String?                @db.VarChar(100)
  currentProvince         String?                @db.VarChar(100)
  currentCountry          String?                @db.VarChar(100)
  currentPostalCode       String?                @db.VarChar(20)
  
  expectedFees            Decimal?               @db.Decimal(10, 2)
  
  schoolId                BigInt
  branchId                BigInt?
  courseId                BigInt?
  createdBy               BigInt
  updatedBy               BigInt?
  createdAt               DateTime               @default(now())
  updatedAt               DateTime               @updatedAt
  deletedAt               DateTime?
  conversionDate          DateTime?
  convertedFromCustomerId BigInt?
  convertedFromCustomer   Customer?              @relation("Student_convertedFromCustomer", fields: [convertedFromCustomerId], references: [id], onDelete: SetNull)
  user                    User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  class                   Class?                 @relation(fields: [classId], references: [id], onDelete: SetNull)
  section                 Section?               @relation(fields: [sectionId], references: [id], onDelete: SetNull)
  parent                  Parent?                @relation(fields: [parentId], references: [id], onDelete: SetNull)
  school                  School                 @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch                  Branch?                @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course                  Course?                @relation(fields: [courseId], references: [id], onDelete: SetNull)
  attendances             Attendance[]
  grades                  Grade[]
  payments                Payment[]
  documents               Document[]
  bookIssues              BookIssue[]
  bookDistributions       BookDistribution[]
  studentTransports       StudentTransport[]
  assignmentSubmissions   AssignmentSubmission[]
  assignmentNotes         AssignmentParentNote[]
  suggestionsComplaints   SuggestionComplaint[]
  events                  StudentEvent[]
  enrollments             StudentEnrollment[]
  cardTracking            StudentCardTracking?

  @@index([userId])
  @@index([admissionNo])
  @@index([classId])
  @@index([sectionId])
  @@index([parentId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([convertedFromCustomerId])
  @@map("students")
}

model StudentCardTracking {
  id            BigInt   @id @default(autoincrement())
  studentId     BigInt   @unique
  printCount    Int      @default(0)
  lastPrintedAt DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?

  student Student @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@map("student_card_tracking")
}

model StudentEnrollment {
  id                BigInt           @id @default(autoincrement())
  uuid              String           @unique @default(uuid()) @db.VarChar(36)
  studentId         BigInt
  classId           BigInt
  sectionId         BigInt?
  academicSessionId BigInt
  rollNo            String?          @db.VarChar(20)
  enrollmentDate    DateTime         @default(now())
  status            EnrollmentStatus @default(ENROLLED)
  remarks           String?          @db.VarChar(500)
  schoolId          BigInt
  branchId          BigInt?
  courseId          BigInt?
  createdBy         BigInt
  updatedBy         BigInt?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  deletedAt         DateTime?
  
  student         Student         @relation(fields: [studentId], references: [id], onDelete: Cascade)
  class           Class           @relation(fields: [classId], references: [id], onDelete: Cascade)
  section         Section?        @relation(fields: [sectionId], references: [id], onDelete: SetNull)
  academicSession AcademicSession @relation(fields: [academicSessionId], references: [id], onDelete: Cascade)
  school          School          @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch          Branch?         @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course          Course?         @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser   User            @relation("StudentEnrollment_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser   User?           @relation("StudentEnrollment_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@unique([studentId, academicSessionId])
  @@index([studentId])
  @@index([classId])
  @@index([sectionId])
  @@index([academicSessionId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([status])
  @@map("student_enrollments")
}

model Parent {
  id           BigInt    @id @default(autoincrement())
  uuid         String    @unique @default(uuid()) @db.VarChar(36)
  userId       BigInt    @unique
  occupation   String?   @db.VarChar(100)
  annualIncome Decimal?  @db.Decimal(12, 2)
  education    String?   @db.VarChar(100)
  schoolId     BigInt
  branchId     BigInt?
  createdBy    BigInt
  updatedBy    BigInt?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime?
  user              User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  school            School                 @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?                @relation(fields: [branchId], references: [id], onDelete: SetNull)
  students          Student[]
  payments          Payment[]
  assignmentNotes   AssignmentParentNote[]
  suggestionsComplaints SuggestionComplaint[]

  @@index([userId])
  @@index([schoolId])
  @@index([branchId])
  @@map("parents")
}

model Staff {
  id            BigInt       @id @default(autoincrement())
  uuid          String       @unique @default(uuid()) @db.VarChar(36)
  userId        BigInt       @unique
  employeeId    String       @unique @db.VarChar(50)
  departmentId  BigInt?
  designation   String       @db.VarChar(100)
  joiningDate   DateTime?
  salary        Decimal?     @db.Decimal(10, 2)
  accountNumber String?      @db.VarChar(30)
  bankName      String?      @db.VarChar(100)
  ifscCode      String?      @db.VarChar(20)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  deletedAt     DateTime?
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  department    Department?  @relation(fields: [departmentId], references: [id], onDelete: SetNull)
  school        School       @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?      @relation(fields: [branchId], references: [id], onDelete: SetNull)
  attendances   Attendance[]
  payrolls      Payroll[]
  documents     Document[]
  bookIssues    BookIssue[]

  @@index([userId])
  @@index([employeeId])
  @@index([departmentId])
  @@index([schoolId])
  @@index([branchId])
  @@map("staff")
}

model Section {
  id         BigInt    @id @default(autoincrement())
  uuid       String    @unique @default(uuid()) @db.VarChar(36)
  name       String    @db.VarChar(50)
  classId    BigInt
  teacherId  BigInt?
  capacity   Int
  roomNumber String?   @db.VarChar(20)
  schoolId   BigInt
  branchId   BigInt?
  courseId   BigInt?
  createdBy  BigInt
  updatedBy  BigInt?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  deletedAt  DateTime?
  class       Class               @relation(fields: [classId], references: [id], onDelete: Cascade)
  school      School              @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch      Branch?             @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course      Course?             @relation(fields: [courseId], references: [id], onDelete: SetNull)
  students    Student[]
  enrollments StudentEnrollment[]

  @@index([classId])
  @@index([teacherId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("sections")
}

model Exam {
  id                  BigInt          @id @default(autoincrement())
  uuid                String          @unique @default(uuid()) @db.VarChar(36)
  name                String          @db.VarChar(100)
  code                String          @unique @db.VarChar(20)
  type                ExamType
  startDate           DateTime
  endDate             DateTime
  description         String?
  totalMarks          Decimal         @db.Decimal(5, 2)
  passingMarks        Decimal         @db.Decimal(5, 2)
  attendanceThreshold Int?            @default(99)  // ایام محرومی (Deprivation days threshold - Excel لیست row 2)
  termId              BigInt?
  classId             BigInt?
  subjectId           BigInt?
  schoolId            BigInt
  branchId            BigInt?
  courseId            BigInt?
  createdBy           BigInt
  updatedBy           BigInt?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  deletedAt           DateTime?
  term                Term?           @relation("Term_exams", fields: [termId], references: [id], onDelete: SetNull)
  class               Class?          @relation(fields: [classId], references: [id], onDelete: SetNull)
  subject             Subject?        @relation(fields: [subjectId], references: [id], onDelete: SetNull)
  school              School          @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch              Branch?         @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course              Course?         @relation(fields: [courseId], references: [id], onDelete: SetNull)
  grades              Grade[]
  timetable           ExamTimetable[]
  excelGradeHeaders   ExcelGradeHeader[]

  @@index([termId])
  @@index([classId])
  @@index([subjectId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([startDate, endDate])
  @@map("exams")
}

model Grade {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  examId        BigInt
  studentId     BigInt
  subjectId     BigInt
  marks         Decimal   @db.Decimal(5, 2)  // مجموعه (Total) = written + practical + activity + homework
  grade         String?   @db.VarChar(5)
  remarks       String?   @db.VarChar(255)
  isAbsent      Boolean   @default(false)
  
  // Component Marks (Excel شقه sheet pattern)
  marksWritten   Decimal?  @db.Decimal(5, 2)  // تحریری (Written exam)
  marksPractical Decimal?  @db.Decimal(5, 2)  // تقریری/عملی (Oral/Practical)
  marksActivity  Decimal?  @db.Decimal(5, 2)  // فعالیت صنفی (Class activity)
  marksHomework  Decimal?  @db.Decimal(5, 2)  // کار خانگی (Homework)
  
  // Special Status Flags (Excel row 10 flags)
  specialFlag    Int?      @default(0)  // 0=none, 1=معذرتی midterm, 2=معذرتی annual, 3=سه پارچه
  
  schoolId      BigInt
  branchId      BigInt?
  courseId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  exam          Exam      @relation(fields: [examId], references: [id], onDelete: Cascade)
  student       Student   @relation(fields: [studentId], references: [id], onDelete: Cascade)
  subject       Subject   @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  school        School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course        Course?   @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser User      @relation("Grade_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?     @relation("Grade_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@unique([examId, studentId, subjectId])
  @@index([examId])
  @@index([studentId])
  @@index([subjectId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([specialFlag])
  @@map("grades")
}

model ExamTimetable {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  examId        BigInt
  subjectId     BigInt
  date          DateTime
  startTime     DateTime  @db.Time(6)
  endTime       DateTime  @db.Time(6)
  roomNumber    String?   @db.VarChar(20)
  schoolId      BigInt
  branchId      BigInt?
  courseId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  exam          Exam      @relation(fields: [examId], references: [id], onDelete: Cascade)
  subject       Subject   @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  school        School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course        Course?   @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser User      @relation("ExamTimetable_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?     @relation("ExamTimetable_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@unique([examId, subjectId])
  @@index([examId])
  @@index([subjectId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("exam_timetables")
}

model ExcelGradeHeader {
  id        BigInt    @id @default(autoincrement())
  classId   BigInt
  examId    BigInt?
  examType  ExamType
  schoolId  BigInt
  data      Json      @default("{}")
  createdBy BigInt?
  updatedBy BigInt?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  class     Class     @relation(fields: [classId], references: [id], onDelete: Cascade)
  exam      Exam?     @relation(fields: [examId], references: [id], onDelete: SetNull)
  school    School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([classId, examType, schoolId])
  @@index([examId])
  @@index([schoolId])
  @@map("excel_grade_headers")
}

model Attendance {
  id                BigInt           @id @default(autoincrement())
  uuid              String           @unique @default(uuid()) @db.VarChar(36)
  date              DateTime
  status            AttendanceStatus
  inTime            DateTime?        // Time when student arrived
  outTime           DateTime?        // Time when student left
  remarks           String?          @db.VarChar(255)
  leaveDocumentPath String?          @db.VarChar(500) // Path to leave document (if status is EXCUSED)
  
  // SMS Tracking Fields
  smsInStatus       SMSStatus?       @default(PENDING) // SMS status for mark-in
  smsInSentAt       DateTime?        // When mark-in SMS was sent
  smsInError        String?          @db.VarChar(500) // Error message if mark-in SMS failed
  smsInAttempts     Int              @default(0) // Number of attempts for mark-in SMS
  smsInRequestId    String?          @db.VarChar(100) // Request ID from SMS API for mark-in
  smsInSource       SMSSource?       @default(AUTO) // Source: AUTO (mark-in endpoint) or MANUAL (resend)
  smsInSentBy       BigInt?          // User who triggered manual send (null for auto)
  
  smsOutStatus      SMSStatus?       @default(PENDING) // SMS status for mark-out
  smsOutSentAt      DateTime?        // When mark-out SMS was sent
  smsOutError       String?          @db.VarChar(500) // Error message if mark-out SMS failed
  smsOutAttempts    Int              @default(0) // Number of attempts for mark-out SMS
  smsOutRequestId   String?          @db.VarChar(100) // Request ID from SMS API for mark-out
  smsOutSource      SMSSource?       @default(AUTO) // Source: AUTO (mark-out endpoint) or MANUAL (resend)
  smsOutSentBy      BigInt?          // User who triggered manual send (null for auto)
  
  studentId         BigInt?
  teacherId         BigInt?
  staffId           BigInt?
  classId           BigInt?
  subjectId         BigInt?
  academicSessionId BigInt?
  schoolId          BigInt
  branchId          BigInt?
  courseId          BigInt?
  createdBy         BigInt
  updatedBy         BigInt?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  deletedAt         DateTime?
  student           Student?         @relation(fields: [studentId], references: [id], onDelete: Cascade)
  teacher           Teacher?         @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  staff             Staff?           @relation(fields: [staffId], references: [id], onDelete: Cascade)
  class             Class?           @relation(fields: [classId], references: [id], onDelete: SetNull)
  subject           Subject?         @relation(fields: [subjectId], references: [id], onDelete: SetNull)
  academicSession   AcademicSession? @relation(fields: [academicSessionId], references: [id], onDelete: SetNull)
  school            School           @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?          @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course            Course?          @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser     User             @relation("Attendance_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser     User?            @relation("Attendance_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@unique([date, studentId, classId, subjectId])
  @@unique([date, teacherId])
  @@unique([date, staffId])
  @@index([studentId])
  @@index([teacherId])
  @@index([staffId])
  @@index([classId])
  @@index([subjectId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([academicSessionId])
  @@index([date])
  @@index([smsInStatus])
  @@index([smsOutStatus])
  @@index([smsInSource])
  @@index([smsOutSource])
  @@index([smsInSentAt])
  @@index([smsOutSentAt])
  @@map("attendances")
}

model FeeStructure {
  id                BigInt           @id @default(autoincrement())
  uuid              String           @unique @default(uuid()) @db.VarChar(36)
  name              String           @db.VarChar(100)
  description       String?
  classId           BigInt?
  academicSessionId BigInt?
  isDefault         Boolean          @default(false)
  schoolId          BigInt
  branchId          BigInt?
  courseId          BigInt?
  createdBy         BigInt
  updatedBy         BigInt?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  deletedAt         DateTime?
  class             Class?           @relation(fields: [classId], references: [id], onDelete: Cascade)
  academicSession   AcademicSession? @relation(fields: [academicSessionId], references: [id], onDelete: SetNull)
  school            School           @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?          @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course            Course?          @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser     User             @relation("FeeStructureCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser     User?            @relation("FeeStructureUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)
  items             FeeItem[]
  payments          Payment[]

  @@index([classId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([academicSessionId])
  @@index([isDefault])
  @@map("fee_structures")
}

model FeeItem {
  id             BigInt        @id @default(autoincrement())
  uuid           String        @unique @default(uuid()) @db.VarChar(36)
  feeStructureId BigInt
  name           String        @db.VarChar(100)
  amount         Decimal       @db.Decimal(10, 2)
  isOptional     Boolean       @default(false)
  dueDate        DateTime?
  schoolId       BigInt
  branchId       BigInt?
  courseId       BigInt?
  createdBy      BigInt
  updatedBy      BigInt?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  deletedAt      DateTime?
  feeStructure   FeeStructure  @relation(fields: [feeStructureId], references: [id], onDelete: Cascade)
  school         School        @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch         Branch?       @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course         Course?       @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser  User          @relation("FeeItem_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser  User?         @relation("FeeItem_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  paymentItems   PaymentItem[]

  @@index([feeStructureId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("fee_items")
}

model Payment {
  id                BigInt        @id @default(autoincrement())
  uuid              String        @unique @default(uuid()) @db.VarChar(36)
  amount            Decimal       @db.Decimal(10, 2)
  discount          Decimal       @default(0.00) @db.Decimal(10, 2)
  fine              Decimal       @default(0.00) @db.Decimal(10, 2)
  total             Decimal       @db.Decimal(10, 2)
  paymentDate       DateTime
  dueDate           DateTime?
  status            PaymentStatus
  method            PaymentMethod
  transactionId     String?       @db.VarChar(100)
  remarks           String?       @db.VarChar(255)
  studentId         BigInt?
  parentId          BigInt?
  feeStructureId    BigInt?
  academicSessionId BigInt?
  schoolId          BigInt
  branchId          BigInt?
  courseId          BigInt?
  createdBy         BigInt
  updatedBy         BigInt?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  deletedAt         DateTime?
  customerId        BigInt?
  student           Student?      @relation(fields: [studentId], references: [id], onDelete: SetNull)
  parent            Parent?       @relation(fields: [parentId], references: [id], onDelete: SetNull)
  customer          Customer?     @relation(fields: [customerId], references: [id], onDelete: SetNull)
  feeStructure      FeeStructure? @relation(fields: [feeStructureId], references: [id], onDelete: SetNull)
  academicSession   AcademicSession? @relation(fields: [academicSessionId], references: [id], onDelete: SetNull)
  school            School        @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?       @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course            Course?       @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser     User          @relation("PaymentCreatedBy", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser     User?         @relation("PaymentUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)
  items             PaymentItem[]

  @@index([studentId])
  @@index([parentId])
  @@index([customerId])
  @@index([feeStructureId])
  @@index([academicSessionId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([status])
  @@index([paymentDate])
  @@map("payments")
}

model PaymentItem {
  id        BigInt    @id @default(autoincrement())
  uuid      String    @unique @default(uuid()) @db.VarChar(36)
  paymentId BigInt
  feeItemId BigInt
  amount    Decimal   @db.Decimal(10, 2)
  discount  Decimal   @default(0.00) @db.Decimal(10, 2)
  fine      Decimal   @default(0.00) @db.Decimal(10, 2)
  total     Decimal   @db.Decimal(10, 2)
  schoolId  BigInt
  branchId  BigInt?
  courseId  BigInt?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  payment   Payment   @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  feeItem   FeeItem   @relation(fields: [feeItemId], references: [id], onDelete: Cascade)
  school    School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch    Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course    Course?   @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@index([paymentId])
  @@index([feeItemId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("payment_items")
}

model Payroll {
  id            BigInt        @id @default(autoincrement())
  uuid          String        @unique @default(uuid()) @db.VarChar(36)
  staffId       BigInt?
  salaryMonth   DateTime
  basicSalary   Decimal       @db.Decimal(10, 2)
  allowances    Decimal       @db.Decimal(10, 2)
  deductions    Decimal       @db.Decimal(10, 2)
  tax           Decimal       @db.Decimal(10, 2)
  bonus         Decimal       @db.Decimal(10, 2)
  netSalary     Decimal       @db.Decimal(10, 2)
  paymentDate   DateTime?
  status        PaymentStatus
  method        PaymentMethod
  transactionId String?       @db.VarChar(100)
  remarks       String?       @db.VarChar(255)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  deletedAt     DateTime?
  staff         Staff?        @relation(fields: [staffId], references: [id], onDelete: Cascade)
  school        School        @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?       @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User          @relation("Payroll_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?         @relation("Payroll_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([staffId])
  @@index([schoolId])
  @@index([branchId])
  @@index([salaryMonth])
  @@index([status])
  @@map("payrolls")
}

model Expense {
  id            BigInt      @id @default(autoincrement())
  uuid          String      @unique @default(uuid()) @db.VarChar(36)
  title         String      @db.VarChar(255)
  description   String?     @db.VarChar(500)
  amount        Decimal     @db.Decimal(10, 2)
  category      String      @db.VarChar(100)
  date          DateTime
  status        String      @db.VarChar(20) @default("PENDING")
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  deletedAt     DateTime?
  school        School      @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?     @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User        @relation("Expense_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?       @relation("Expense_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([title])
  @@index([category])
  @@index([date])
  @@index([status])
  @@index([schoolId])
  @@index([branchId])
  @@map("expenses")
}

model Book {
  id            BigInt      @id @default(autoincrement())
  uuid          String      @unique @default(uuid()) @db.VarChar(36)
  title         String      @db.VarChar(255)
  author        String      @db.VarChar(100)
  isbn          String?     @unique @db.VarChar(20)
  publisher     String?     @db.VarChar(100)
  edition       String?     @db.VarChar(50)
  subjectId     BigInt?
  quantity      Int         @default(1)
  available     Int         @default(1)
  shelfNumber   String?     @db.VarChar(20)
  price         Decimal?    @db.Decimal(10, 2)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  deletedAt     DateTime?
  subject       Subject?    @relation(fields: [subjectId], references: [id], onDelete: SetNull)
  school        School      @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?     @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User        @relation("Book_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?       @relation("Book_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  bookIssues    BookIssue[]

  @@index([title])
  @@index([author])
  @@index([subjectId])
  @@index([schoolId])
  @@index([branchId])
  @@map("books")
}

model BookIssue {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  bookId        BigInt
  studentId     BigInt?
  staffId       BigInt?
  issueDate     DateTime
  dueDate       DateTime
  returnDate    DateTime?
  fineAmount    Decimal   @default(0.00) @db.Decimal(10, 2)
  remarks       String?   @db.VarChar(255)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  status        String    @db.VarChar(20)
  book          Book      @relation(fields: [bookId], references: [id], onDelete: Cascade)
  student       Student?  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  staff         Staff?    @relation(fields: [staffId], references: [id], onDelete: Cascade)
  school        School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User      @relation("BookIssue_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?     @relation("BookIssue_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([bookId])
  @@index([studentId])
  @@index([staffId])
  @@index([schoolId])
  @@index([branchId])
  @@index([status])
  @@index([dueDate])
  @@map("book_issues")
}

model InventoryCategory {
  id            BigInt          @id @default(autoincrement())
  uuid          String          @unique @default(uuid()) @db.VarChar(36)
  name          String          @db.VarChar(100)
  description   String?
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  deletedAt     DateTime?
  school        School          @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?         @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User            @relation("InventoryCategory_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?           @relation("InventoryCategory_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  items         InventoryItem[]

  @@index([name])
  @@index([schoolId])
  @@index([branchId])
  @@map("inventory_categories")
}

model InventoryItem {
  id            BigInt             @id @default(autoincrement())
  uuid          String             @unique @default(uuid()) @db.VarChar(36)
  name          String             @db.VarChar(100)
  description   String?
  categoryId    BigInt?
  quantity      Int                @default(0)
  minQuantity   Int                @default(0)
  price         Decimal?           @db.Decimal(10, 2)
  location      String?            @db.VarChar(100)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  deletedAt     DateTime?
  supplier      String?            @db.VarChar(100)
  unit          String?            @db.VarChar(20)
  category      InventoryCategory? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  school        School             @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?            @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User               @relation("InventoryItem_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?              @relation("InventoryItem_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  inventoryLogs InventoryLog[]

  @@index([name])
  @@index([categoryId])
  @@index([schoolId])
  @@index([branchId])
  @@map("inventory_items")
}

model InventoryLog {
  id            BigInt        @id @default(autoincrement())
  uuid          String        @unique @default(uuid()) @db.VarChar(36)
  itemId        BigInt
  quantity      Int
  referenceId   BigInt?
  referenceType String?       @db.VarChar(50)
  remarks       String?       @db.VarChar(255)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  deletedAt     DateTime?
  type          String        @db.VarChar(20)
  item          InventoryItem @relation(fields: [itemId], references: [id], onDelete: Cascade)
  school        School        @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?       @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User          @relation("InventoryLog_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?         @relation("InventoryLog_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([itemId])
  @@index([schoolId])
  @@index([branchId])
  @@index([type])
  @@index([createdAt])
  @@map("inventory_logs")
}

model Income {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  amount        Decimal   @db.Decimal(10, 2)
  reference_id  BigInt?
  added_by      BigInt?
  description   String?   @db.VarChar(255)
  source        String    @default("other") @db.VarChar(50)
  income_date   DateTime  @default(now())
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  school        School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User      @relation("Income_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?     @relation("Income_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([schoolId])
  @@index([branchId])
  @@index([income_date])
  @@index([source])
  @@map("incomes")
}

model Facility {
  id            BigInt            @id @default(autoincrement())
  uuid          String            @unique @default(uuid()) @db.VarChar(36)
  name          String            @db.VarChar(100)
  type          String            @db.VarChar(50)
  capacity      Int?
  location      String?           @db.VarChar(100)
  description   String?
  status        String            @db.VarChar(20)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  deletedAt     DateTime?
  school        School            @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?           @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User              @relation("Facility_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?             @relation("Facility_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  bookings      FacilityBooking[]

  @@index([name])
  @@index([type])
  @@index([schoolId])
  @@index([branchId])
  @@map("facilities")
}

model FacilityBooking {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  facilityId    BigInt
  bookedById    BigInt
  startTime     DateTime
  endTime       DateTime
  purpose       String?   @db.VarChar(255)
  status        String    @db.VarChar(20)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  facility      Facility  @relation(fields: [facilityId], references: [id], onDelete: Cascade)
  bookedBy      User      @relation("FacilityBooking_bookedBy", fields: [bookedById], references: [id], onDelete: Cascade)
  school        School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User      @relation("FacilityBooking_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?     @relation("FacilityBooking_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([facilityId])
  @@index([bookedById])
  @@index([schoolId])
  @@index([branchId])
  @@index([startTime, endTime])
  @@map("facility_bookings")
}

model Vehicle {
  id             BigInt    @id @default(autoincrement())
  uuid           String    @unique @default(uuid()) @db.VarChar(36)
  registrationNo String    @unique @db.VarChar(20)
  type           String    @db.VarChar(50)
  capacity       Int
  driverId       BigInt?
  attendantId    BigInt?
  status         String    @db.VarChar(20)
  schoolId       BigInt
  branchId       BigInt?
  createdBy      BigInt
  updatedBy      BigInt?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  deletedAt      DateTime?
  driver         User?     @relation("VehicleDriver", fields: [driverId], references: [id], onDelete: SetNull)
  attendant      User?     @relation("VehicleAttendant", fields: [attendantId], references: [id], onDelete: SetNull)
  school         School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch         Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser  User      @relation("Vehicle_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser  User?     @relation("Vehicle_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  routes         Route[]
  trips          Trip[]

  @@index([registrationNo])
  @@index([driverId])
  @@index([attendantId])
  @@index([schoolId])
  @@index([branchId])
  @@map("vehicles")
}

model Route {
  id            BigInt             @id @default(autoincrement())
  uuid          String             @unique @default(uuid()) @db.VarChar(36)
  name          String             @db.VarChar(100)
  startPoint    String             @db.VarChar(100)
  endPoint      String             @db.VarChar(100)
  distance      Decimal?           @db.Decimal(5, 2)
  vehicleId     BigInt?
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  deletedAt     DateTime?
  vehicle       Vehicle?           @relation(fields: [vehicleId], references: [id], onDelete: SetNull)
  school        School             @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?            @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User               @relation("Route_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?              @relation("Route_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  stops         RouteStop[]
  trips         Trip[]
  students      StudentTransport[]

  @@index([name])
  @@index([vehicleId])
  @@index([schoolId])
  @@index([branchId])
  @@map("routes")
}

model RouteStop {
  id                BigInt             @id @default(autoincrement())
  uuid              String             @unique @default(uuid()) @db.VarChar(36)
  routeId           BigInt
  name              String             @db.VarChar(100)
  sequence          Int
  arrivalTime       DateTime           @db.Time(6)
  departureTime     DateTime           @db.Time(6)
  schoolId          BigInt
  branchId          BigInt?
  createdBy         BigInt
  updatedBy         BigInt?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  deletedAt         DateTime?
  route             Route              @relation(fields: [routeId], references: [id], onDelete: Cascade)
  school            School             @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?            @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser     User               @relation("RouteStop_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser     User?              @relation("RouteStop_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  studentTransports StudentTransport[]

  @@unique([routeId, sequence])
  @@index([routeId])
  @@index([schoolId])
  @@index([branchId])
  @@map("route_stops")
}

model Trip {
  id            BigInt                @id @default(autoincrement())
  uuid          String                @unique @default(uuid()) @db.VarChar(36)
  routeId       BigInt
  vehicleId     BigInt
  tripType      String                @db.VarChar(20)
  startTime     DateTime              @db.Time(6)
  endTime       DateTime              @db.Time(6)
  status        String                @db.VarChar(20)
  tripDate      DateTime
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  deletedAt     DateTime?
  route         Route                 @relation(fields: [routeId], references: [id], onDelete: Cascade)
  vehicle       Vehicle               @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  school        School                @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?               @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User                  @relation("Trip_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?                 @relation("Trip_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  attendances   TransportAttendance[]

  @@index([routeId])
  @@index([vehicleId])
  @@index([schoolId])
  @@index([branchId])
  @@index([tripDate])
  @@index([status])
  @@map("trips")
}

model StudentTransport {
  id            BigInt                @id @default(autoincrement())
  uuid          String                @unique @default(uuid()) @db.VarChar(36)
  studentId     BigInt
  routeId       BigInt
  stopId        BigInt
  pickupTime    DateTime              @db.Time(6)
  dropoffTime   DateTime              @db.Time(6)
  fee           Decimal               @db.Decimal(10, 2)
  status        String                @db.VarChar(20)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  deletedAt     DateTime?
  student       Student               @relation(fields: [studentId], references: [id], onDelete: Cascade)
  route         Route                 @relation(fields: [routeId], references: [id], onDelete: Cascade)
  stop          RouteStop             @relation(fields: [stopId], references: [id], onDelete: Cascade)
  school        School                @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?               @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User                  @relation("StudentTransport_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?                 @relation("StudentTransport_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  attendances   TransportAttendance[]

  @@index([studentId])
  @@index([routeId])
  @@index([stopId])
  @@index([schoolId])
  @@index([branchId])
  @@map("student_transports")
}

model TransportAttendance {
  id                 BigInt           @id @default(autoincrement())
  uuid               String           @unique @default(uuid()) @db.VarChar(36)
  studentTransportId BigInt
  tripId             BigInt
  date               DateTime
  status             AttendanceStatus
  remarks            String?          @db.VarChar(255)
  schoolId           BigInt
  branchId           BigInt?
  createdBy          BigInt
  updatedBy          BigInt?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  deletedAt          DateTime?
  studentTransport   StudentTransport @relation(fields: [studentTransportId], references: [id], onDelete: Cascade)
  trip               Trip             @relation(fields: [tripId], references: [id], onDelete: Cascade)
  school             School           @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch             Branch?          @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser      User             @relation("TransportAttendance_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser      User?            @relation("TransportAttendance_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([studentTransportId])
  @@index([tripId])
  @@index([schoolId])
  @@index([branchId])
  @@index([date])
  @@map("transport_attendances")
}

model Notice {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  title         String    @db.VarChar(255)
  content       String
  startDate     DateTime
  endDate       DateTime
  isPublished   Boolean   @default(false)
  priority      String    @db.VarChar(20)
  targetRoles   String?   @db.LongText
  classIds      String?   @db.LongText
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  school        School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User      @relation("Notice_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?     @relation("Notice_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([schoolId])
  @@index([branchId])
  @@index([isPublished])
  @@index([startDate, endDate])
  @@map("notices")
}

model Event {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  title         String    @db.VarChar(255)
  description   String
  startDateTime DateTime
  endDateTime   DateTime
  location      String?   @db.VarChar(100)
  isPublished   Boolean   @default(false)
  targetRoles   String?   @db.LongText
  classIds      String?   @db.LongText
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  school        School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)

  @@index([schoolId])
  @@index([branchId])
  @@index([isPublished])
  @@index([startDateTime, endDateTime])
  @@map("events")
}

model Conversation {
  id                    BigInt                     @id @default(autoincrement())
  uuid                  String                     @unique @default(uuid()) @db.VarChar(36)
  name                  String?                    @db.VarChar(255)
  description           String?
  type                  ConversationType           @default(DIRECT)
  isActive              Boolean                    @default(true)
  isArchived            Boolean                    @default(false)
  isPinned              Boolean                    @default(false)
  isMuted               Boolean                    @default(false)
  isEncrypted           Boolean                    @default(false)
  encryptionType        EncryptionType             @default(NONE)
  encryptionKey         String?
  lastMessageAt         DateTime?
  lastMessageId         BigInt?
  schoolId              BigInt
  branchId              BigInt?
  createdBy             BigInt
  updatedBy             BigInt?
  createdAt             DateTime                   @default(now())
  updatedAt             DateTime                   @updatedAt
  deletedAt             DateTime?
  school                School?                    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch                Branch?                    @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser         User                       @relation("Conversation_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser         User?                      @relation("Conversation_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  participants          ConversationParticipant[]
  messages              Message[]
  lastMessage           Message?                   @relation("Conversation_lastMessage", fields: [lastMessageId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  polls                 MessagePoll[]
  attachments           MessageAttachment[]
  analytics             MessageAnalytics[]
  threads               MessageThread[]
  notifications         ConversationNotification[]
  settings              ConversationSetting[]
  conversationAnalytics ConversationAnalytics[]

  @@index([type])
  @@index([schoolId])
  @@index([branchId])
  @@index([createdBy])
  @@index([lastMessageAt])
  @@index([isActive])
  @@index([isArchived])
  @@map("conversations")
}

model ConversationParticipant {
  id                BigInt       @id @default(autoincrement())
  uuid              String       @unique @default(uuid()) @db.VarChar(36)
  conversationId    BigInt
  userId            BigInt
  role              String       @default("MEMBER") @db.VarChar(50)
  permissions       String?      @db.LongText
  isActive          Boolean      @default(true)
  isMuted           Boolean      @default(false)
  isPinned          Boolean      @default(false)
  lastReadAt        DateTime?
  lastReadMessageId BigInt?
  joinedAt          DateTime     @default(now())
  leftAt            DateTime?
  schoolId          BigInt
  branchId          BigInt?
  createdBy         BigInt
  updatedBy         BigInt?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  conversation      Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  lastReadMessage   Message?     @relation("Participant_lastReadMessage", fields: [lastReadMessageId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  createdByUser     User         @relation("ConversationParticipant_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser     User?        @relation("ConversationParticipant_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  school            School?      @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?      @relation(fields: [branchId], references: [id], onDelete: SetNull)
  lastReadBy        User[]       @relation("Participant_lastReadMessage")

  @@unique([conversationId, userId])
  @@index([conversationId])
  @@index([userId])
  @@index([role])
  @@index([isActive])
  @@index([schoolId])
  @@index([branchId])
  @@map("conversation_participants")
}

model Message {
  id                      BigInt                    @id @default(autoincrement())
  uuid                    String                    @unique @default(uuid()) @db.VarChar(36)
  senderId                BigInt
  receiverId              BigInt?
  subject                 String?                   @db.VarChar(255)
  content                 String
  isRead                  Boolean                   @default(false)
  schoolId                BigInt
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @updatedAt
  deletedAt               DateTime?
  aiAnalysis              String?                   @db.LongText
  contentEncrypted        String?
  contentHtml             String?
  contentMarkdown         String?
  conversationId          BigInt?
  createdBy               BigInt
  deliveredAt             DateTime?
  editedAt                DateTime?
  encryptionKey           String?
  encryptionType          EncryptionType            @default(NONE)
  hashtags                String?                   @db.LongText
  isArchived              Boolean                   @default(false)
  isDeleted               Boolean                   @default(false)
  isEdited                Boolean                   @default(false)
  isEncrypted             Boolean                   @default(false)
  isForwarded             Boolean                   @default(false)
  isPinned                Boolean                   @default(false)
  language                String?                   @db.VarChar(10)
  links                   String?                   @db.LongText
  mentions                String?                   @db.LongText
  metadata                String?                   @db.LongText
  priority                MessagePriority           @default(NORMAL)
  readAt                  DateTime?
  replyToId               BigInt?
  scheduledAt             DateTime?
  sentiment               String?                   @db.VarChar(50)
  status                  MessageStatus             @default(SENT)
  tags                    String?                   @db.LongText
  threadId                BigInt?
  type                    MessageType               @default(DIRECT)
  updatedBy               BigInt?
  branchId                BigInt?
  conversation            Conversation?             @relation(fields: [conversationId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  sender                  User                      @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver                User?                     @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  replyTo                 Message?                  @relation("Message_replies", fields: [replyToId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  replies                 Message[]                 @relation("Message_replies")
  thread                  MessageThread?            @relation(fields: [threadId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  school                  School?                   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch                  Branch?                   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser           User                      @relation("Message_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser           User?                     @relation("Message_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  attachments             MessageAttachment[]
  reactions               MessageReaction[]
  forwards                MessageForward[]
  analytics               MessageAnalytics[]
  notifications           MessageNotification[]
  participants            ConversationParticipant[] @relation("Participant_lastReadMessage")
  conversationLastMessage Conversation[]            @relation("Conversation_lastMessage")
  threadRootMessage       MessageThread[]           @relation("Thread_rootMessage")
  threadLastMessage       MessageThread[]           @relation("Thread_lastMessage")
  originalForwards        MessageForward[]          @relation("Forward_originalMessage")
  forwardedMessages       MessageForward[]          @relation("Forward_forwardedMessage")

  @@index([conversationId])
  @@index([senderId])
  @@index([receiverId])
  @@index([replyToId])
  @@index([threadId])
  @@index([type])
  @@index([priority])
  @@index([status])
  @@index([isRead])
  @@index([schoolId])
  @@index([branchId])
  @@index([scheduledAt])
  @@index([createdAt])
  @@map("messages")
}

model MessageThread {
  id               BigInt       @id @default(autoincrement())
  uuid             String       @unique @default(uuid()) @db.VarChar(36)
  conversationId   BigInt
  rootMessageId    BigInt
  title            String?      @db.VarChar(255)
  description      String?
  isActive         Boolean      @default(true)
  isPinned         Boolean      @default(false)
  isArchived       Boolean      @default(false)
  participantCount Int          @default(0)
  messageCount     Int          @default(0)
  lastMessageAt    DateTime?
  lastMessageId    BigInt?
  schoolId         BigInt
  branchId         BigInt?
  createdBy        BigInt
  updatedBy        BigInt?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  deletedAt        DateTime?
  conversation     Conversation @relation(fields: [conversationId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  rootMessage      Message      @relation("Thread_rootMessage", fields: [rootMessageId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  lastMessage      Message?     @relation("Thread_lastMessage", fields: [lastMessageId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  messages         Message[]
  school           School?      @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch           Branch?      @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser    User         @relation("MessageThread_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser    User?        @relation("MessageThread_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([conversationId])
  @@index([rootMessageId])
  @@index([schoolId])
  @@index([branchId])
  @@index([isActive])
  @@index([lastMessageAt])
  @@map("message_threads")
}

model MessageAttachment {
  id             BigInt         @id @default(autoincrement())
  uuid           String         @unique @default(uuid()) @db.VarChar(36)
  messageId      BigInt?
  conversationId BigInt?
  name           String         @db.VarChar(255)
  originalName   String         @db.VarChar(255)
  path           String         @db.VarChar(500)
  url            String?        @db.VarChar(500)
  mimeType       String         @db.VarChar(100)
  size           Int            @default(0)
  type           AttachmentType @default(OTHER)
  isEncrypted    Boolean        @default(false)
  encryptionKey  String?
  metadata       String?        @db.LongText
  schoolId       BigInt?      @map("school_id")
  branchId       BigInt?
  createdBy      BigInt
  updatedBy      BigInt?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  deletedAt      DateTime?
  message        Message?       @relation(fields: [messageId], references: [id], onDelete: Cascade)
  conversation   Conversation?  @relation(fields: [conversationId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  school         School?        @relation(fields: [schoolId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  branch         Branch?        @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser  User           @relation("MessageAttachment_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser  User?          @relation("MessageAttachment_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([messageId])
  @@index([conversationId])
  @@index([schoolId])
  @@index([branchId])
  @@index([type])
  @@index([mimeType])
  @@map("message_attachments")
}

model MessageReaction {
  id        BigInt              @id @default(autoincrement())
  uuid      String              @unique @default(uuid()) @db.VarChar(36)
  messageId BigInt
  userId    BigInt
  reaction  MessageReactionType
  metadata  String?             @db.LongText
  schoolId  BigInt?
  branchId  BigInt?
  createdAt DateTime            @default(now())
  updatedAt DateTime            @updatedAt
  message   Message             @relation(fields: [messageId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  user      User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  school    School?             @relation(fields: [schoolId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  branch    Branch?             @relation(fields: [branchId], references: [id], onDelete: SetNull)

  @@unique([messageId, userId, reaction])
  @@index([messageId])
  @@index([userId])
  @@index([reaction])
  @@index([schoolId])
  @@index([branchId])
  @@map("message_reactions")
}

model MessageForward {
  id                 BigInt   @id @default(autoincrement())
  uuid               String   @unique @default(uuid()) @db.VarChar(36)
  originalMessageId  BigInt
  forwardedMessageId BigInt
  forwardedByUserId  BigInt
  forwardedToUserId  BigInt
  forwardedAt        DateTime @default(now())
  metadata           String?  @db.LongText
  schoolId           BigInt?
  branchId           BigInt?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  messageId          BigInt
  originalMessage    Message  @relation("Forward_originalMessage", fields: [originalMessageId], references: [id], onDelete: Cascade)
  forwardedMessage   Message  @relation("Forward_forwardedMessage", fields: [forwardedMessageId], references: [id], onDelete: Cascade)
  forwardedByUser    User     @relation("MessageForward_forwardedByUser", fields: [forwardedByUserId], references: [id], onDelete: Cascade)
  forwardedToUser    User     @relation("MessageForward_forwardedToUser", fields: [forwardedToUserId], references: [id], onDelete: Cascade)
  school             School?  @relation(fields: [schoolId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  branch             Branch?  @relation(fields: [branchId], references: [id], onDelete: SetNull)
  message            Message  @relation(fields: [messageId], references: [id])

  @@index([originalMessageId])
  @@index([forwardedMessageId])
  @@index([forwardedByUserId])
  @@index([forwardedToUserId])
  @@index([schoolId])
  @@index([branchId])
  @@map("message_forwards")
}

model MessagePoll {
  id             BigInt       @id @default(autoincrement())
  uuid           String       @unique @default(uuid()) @db.VarChar(36)
  conversationId BigInt
  question       String
  options        String?      @db.LongText
  votes          String?      @db.LongText
  isActive       Boolean      @default(true)
  expiresAt      DateTime?
  schoolId       BigInt?     @map("schoolId")
  branchId       BigInt?
  createdBy      BigInt
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  school         School?      @relation(fields: [schoolId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  branch         Branch?      @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser  User         @relation("MessagePoll_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([schoolId])
  @@index([branchId])
  @@index([isActive])
  @@index([expiresAt])
  @@map("message_polls")
}

model ConversationSetting {
  id             BigInt       @id @default(autoincrement())
  uuid           String       @unique @default(uuid()) @db.VarChar(36)
  conversationId BigInt
  key            String       @db.VarChar(100)
  value          String
  metadata       String?      @db.LongText
  schoolId       BigInt?
  branchId       BigInt?
  createdBy      BigInt
  updatedBy      BigInt?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  createdByUser  User         @relation("ConversationSetting_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser  User?        @relation("ConversationSetting_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  school         School?      @relation(fields: [schoolId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  branch         Branch?      @relation(fields: [branchId], references: [id], onDelete: SetNull)

  @@unique([conversationId, key])
  @@index([conversationId])
  @@index([key])
  @@index([schoolId])
  @@index([branchId])
  @@map("conversation_settings")
}

model MessageNotification {
  id        BigInt    @id @default(autoincrement())
  uuid      String    @unique @default(uuid()) @db.VarChar(36)
  messageId BigInt
  userId    BigInt
  type      String    @db.VarChar(50)
  title     String    @db.VarChar(255)
  body      String
  isRead    Boolean   @default(false)
  readAt    DateTime?
  metadata  String?   @db.LongText
  schoolId  BigInt?
  branchId  BigInt?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  message   Message   @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  school    School?   @relation(fields: [schoolId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  branch    Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)

  @@index([messageId])
  @@index([userId])
  @@index([type])
  @@index([isRead])
  @@index([schoolId])
  @@index([branchId])
  @@map("message_notifications")
}

model ConversationNotification {
  id             BigInt       @id @default(autoincrement())
  uuid           String       @unique @default(uuid()) @db.VarChar(36)
  conversationId BigInt
  userId         BigInt
  type           String       @db.VarChar(50)
  title          String       @db.VarChar(255)
  body           String
  isRead         Boolean      @default(false)
  readAt         DateTime?
  metadata       String?      @db.LongText
  schoolId       BigInt?
  branchId       BigInt?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  school         School?      @relation(fields: [schoolId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  branch         Branch?      @relation(fields: [branchId], references: [id], onDelete: SetNull)

  @@index([conversationId])
  @@index([userId])
  @@index([type])
  @@index([isRead])
  @@index([schoolId])
  @@index([branchId])
  @@map("conversation_notifications")
}

model MessageAnalytics {
  id             BigInt        @id @default(autoincrement())
  uuid           String        @unique @default(uuid()) @db.VarChar(36)
  messageId      BigInt
  conversationId BigInt?
  userId         BigInt
  action         String        @db.VarChar(50)
  metadata       String?       @db.LongText
  schoolId       BigInt?
  branchId       BigInt?
  createdAt      DateTime      @default(now())
  message        Message       @relation(fields: [messageId], references: [id], onDelete: Cascade)
  conversation   Conversation? @relation(fields: [conversationId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  user           User          @relation(fields: [userId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  school         School?       @relation(fields: [schoolId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  branch         Branch?       @relation(fields: [branchId], references: [id], onDelete: SetNull)

  @@index([messageId])
  @@index([conversationId])
  @@index([userId])
  @@index([action])
  @@index([schoolId])
  @@index([branchId])
  @@index([createdAt])
  @@map("message_analytics")
}

model ConversationAnalytics {
  id             BigInt       @id @default(autoincrement())
  uuid           String       @unique @default(uuid()) @db.VarChar(36)
  conversationId BigInt
  userId         BigInt
  action         String       @db.VarChar(50)
  metadata       String?      @db.LongText
  schoolId       BigInt?
  branchId       BigInt?
  createdAt      DateTime     @default(now())
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  school         School?      @relation(fields: [schoolId], references: [id], onDelete: Restrict, onUpdate: Restrict)
  branch         Branch?      @relation(fields: [branchId], references: [id], onDelete: SetNull)

  @@index([conversationId])
  @@index([userId])
  @@index([action])
  @@index([schoolId])
  @@index([branchId])
  @@index([createdAt])
  @@map("conversation_analytics")
}

model Document {
  id            BigInt       @id @default(autoincrement())
  uuid          String       @unique @default(uuid()) @db.VarChar(36)
  title         String       @db.VarChar(255)
  description   String?
  type          DocumentType
  path          String       @db.VarChar(255)
  mimeType      String       @db.VarChar(100)
  size          Int          @default(0)
  studentId     BigInt?
  teacherId     BigInt?
  staffId       BigInt?
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  deletedAt     DateTime?
  customerId    BigInt?
  student       Student?     @relation(fields: [studentId], references: [id], onDelete: Cascade)
  teacher       Teacher?     @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  staff         Staff?       @relation(fields: [staffId], references: [id], onDelete: Cascade)
  customer      Customer?    @relation(fields: [customerId], references: [id], onDelete: Cascade)
  school        School       @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?      @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User         @relation("Document_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?        @relation("Document_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([title])
  @@index([type])
  @@index([studentId])
  @@index([teacherId])
  @@index([staffId])
  @@index([customerId])
  @@index([schoolId])
  @@index([branchId])
  @@map("documents")
}

model AuditLog {
  id         BigInt    @id @default(autoincrement())
  uuid       String    @unique @default(uuid()) @db.VarChar(36)
  action     String    @db.VarChar(50)
  entityType String    @db.VarChar(50)
  entityId   BigInt
  oldData    String?   @db.LongText
  newData    String?   @db.LongText
  ipAddress  String?   @db.VarChar(45)
  userAgent  String?   @db.VarChar(255)
  requestMethod String?   @db.VarChar(10)
  requestPath   String?   @db.VarChar(255)
  requestUrl    String?   @db.VarChar(512)
  requestHeaders Json?     @db.Json
  requestQuery   Json?     @db.Json
  requestBody    Json?     @db.Json
  responseStatus Int?
  responseTimeMs Int?
  isSuccess      Boolean?  @default(true)
  errorMessage   String?   @db.LongText
  correlationId  String?   @db.VarChar(64)
  traceId        String?   @db.VarChar(64)
  ownerId    BigInt?
  schoolId   BigInt?
  branchId   BigInt?
  userId     BigInt?
  createdAt  DateTime  @default(now())
  customerId BigInt?
  owner      Owner?    @relation("Owner_auditLogs", fields: [ownerId], references: [id], onDelete: SetNull)
  school     School?   @relation(fields: [schoolId], references: [id], onDelete: SetNull)
  branch     Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  user       User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  customer   Customer? @relation(fields: [customerId], references: [id], onDelete: SetNull)

  @@index([action])
  @@index([entityType, entityId])
  @@index([ownerId])
  @@index([schoolId])
  @@index([branchId])
  @@index([userId])
  @@index([customerId])
  @@index([createdAt])
  @@index([requestMethod])
  @@index([responseStatus])
  @@index([isSuccess])
  @@map("audit_logs")
}

model Session {
  id           BigInt   @id @default(autoincrement())
  uuid         String   @unique @default(uuid()) @db.VarChar(36)
  token        String   @unique @db.VarChar(255)
  ipAddress    String?  @db.VarChar(45)
  userAgent    String?  @db.VarChar(255)
  expiresAt    DateTime
  ownerId      BigInt?
  userId       BigInt?
  branchId     BigInt?  @map("branchId")
  courseId     BigInt?  @map("courseId")
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  refreshToken String?  @unique @db.VarChar(255)
  status       String   @default("active") @db.VarChar(20)
  deviceType   String?  @db.VarChar(50)
  owner        Owner?   @relation("Owner_sessions", fields: [ownerId], references: [id], onDelete: Cascade)
  user         User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  branch       Branch?  @relation("BranchSessions", fields: [branchId], references: [id], onDelete: SetNull)
  course       Course?  @relation("CourseSessions", fields: [courseId], references: [id], onDelete: SetNull)

  @@index([token])
  @@index([refreshToken])
  @@index([ownerId])
  @@index([userId])
  @@index([branchId])
  @@index([courseId])
  @@index([expiresAt])
  @@map("sessions")
}

model SystemSetting {
  id        BigInt    @id @default(autoincrement())
  uuid      String    @unique @default(uuid()) @db.VarChar(36)
  key       String    @unique @db.VarChar(100)
  value     String
  isPublic  Boolean   @default(false)
  schoolId  BigInt?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  school    School?   @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@index([key])
  @@index([schoolId])
  @@map("system_settings")
}

model SchoolSetting {
  id        BigInt    @id @default(autoincrement())
  uuid      String    @unique @default(uuid()) @db.VarChar(36)
  key       String    @db.VarChar(100)
  value     String
  isPublic  Boolean   @default(false)
  schoolId  BigInt
  branchId  BigInt?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  school    School    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch    Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)

  @@unique([schoolId, key])
  @@index([key])
  @@index([schoolId])
  @@index([branchId])
  @@map("school_settings")
}

model ReportSchedule {
  id            BigInt              @id @default(autoincrement())
  uuid          String              @unique @default(uuid()) @db.VarChar(36)
  reportKey     String              @db.VarChar(100)
  filters       Json
  format        ReportFormat        @default(CSV)
  frequency     ReportFrequency     @default(DAILY)
  cronExpression String?
  recipients    Json
  status        ReportScheduleStatus @default(ACTIVE)
  lastRunAt     DateTime?
  nextRunAt     DateTime?
  createdBy     BigInt?
  schoolId      BigInt?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  exports       ReportExport[]
  school        School?             @relation(fields: [schoolId], references: [id], onDelete: SetNull)

  @@index([reportKey])
  @@index([status])
  @@index([schoolId])
  @@map("report_schedules")
}

model ReportExport {
  id           BigInt         @id @default(autoincrement())
  uuid         String         @unique @default(uuid()) @db.VarChar(36)
  reportKey    String         @db.VarChar(100)
  filters      Json
  format       ReportFormat   @default(CSV)
  status       ExportStatus   @default(QUEUED)
  resultUrl    String?        @db.VarChar(500)
  errorMessage String?        @db.VarChar(500)
  createdBy    BigInt?
  schoolId     BigInt?
  requestedAt  DateTime       @default(now())
  completedAt  DateTime?
  expiresAt    DateTime?
  scheduleId   BigInt?
  schedule     ReportSchedule? @relation(fields: [scheduleId], references: [id], onDelete: SetNull)
  school       School?        @relation(fields: [schoolId], references: [id], onDelete: SetNull)

  @@index([reportKey])
  @@index([status])
  @@index([schoolId])
  @@index([requestedAt])
  @@map("report_exports")
}

model LogDailyRollup {
  id               BigInt   @id @default(autoincrement())
  date             DateTime
  schoolId         BigInt
  totalEvents      Int      @default(0)
  successEvents    Int      @default(0)
  warningEvents    Int      @default(0)
  errorEvents      Int      @default(0)
  averageLatencyMs Float?
  topActions       Json?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  school           School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([schoolId, date])
  @@index([date])
  @@index([schoolId])
  @@map("log_daily_rollups")
}

enum ReportFrequency {
  DAILY
  WEEKLY
  MONTHLY
}

enum ReportScheduleStatus {
  ACTIVE
  PAUSED
  CANCELLED
}

enum ExportStatus {
  QUEUED
  PROCESSING
  COMPLETED
  FAILED
  EXPIRED
}

enum ReportFormat {
  CSV
  PDF
}
model CustomReport {
  id            BigInt      @id @default(autoincrement())
  uuid          String      @unique @default(uuid()) @db.VarChar(36)
  name          String      @db.VarChar(120)
  description   String?     @db.VarChar(255)
  reportKey     String      @db.VarChar(100)
  metrics       Json
  dimensions    Json
  filters       Json
  visualization Json
  isShared      Boolean     @default(false)
  createdBy     BigInt?
  schoolId      BigInt?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  owner         User?       @relation("CustomReport_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  school        School?     @relation(fields: [schoolId], references: [id], onDelete: SetNull)

  @@index([createdBy])
  @@index([schoolId])
  @@map("custom_reports")
}
model Package {
  id            BigInt                 @id @default(autoincrement())
  uuid          String                 @unique @default(uuid()) @db.VarChar(36)
  name          String                 @unique @db.VarChar(100)
  description   String?
  priceMonthly  Decimal                @db.Decimal(10, 2)
  priceYearly   Decimal                @db.Decimal(10, 2)
  isActive      Boolean                @default(true)
  features      Json
  supportLevel  String?                @db.VarChar(50)
  schoolId      BigInt?                @map("school_id")
  createdBy     BigInt?
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  createdByUser User?                  @relation("Package_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull, onUpdate: NoAction)
  school        School?                @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  subscriptions SchoolSubscription[]

  @@index([isActive])
  @@index([supportLevel])
  @@index([schoolId])
  @@map("packages")
}

model SchoolSubscription {
  id              BigInt               @id @default(autoincrement())
  uuid            String               @unique @default(uuid()) @db.VarChar(36)
  schoolId        BigInt
  branchId        BigInt?
  packageId       BigInt
  status          SubscriptionStatus   @default(ACTIVE)
  startedAt       DateTime?
  expiresAt       DateTime?
  autoRenew       Boolean              @default(false)
  currentUsage    Json?
  paymentStatus   String?              @db.VarChar(30)
  lastPaymentDate DateTime?
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  school          School               @relation("School_allSubscriptions", fields: [schoolId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  primarySchool   School?              @relation("School_primarySubscription")
  branch          Branch?              @relation(fields: [branchId], references: [id], onDelete: SetNull)
  package         Package              @relation(fields: [packageId], references: [id], onDelete: Restrict, onUpdate: NoAction)

  @@index([schoolId])
  @@index([branchId])
  @@index([packageId])
  @@index([status])
  @@index([expiresAt])
  @@map("school_subscriptions")
}

model Assignment {
  id            BigInt                 @id @default(autoincrement())
  uuid          String                 @unique @default(uuid()) @db.VarChar(36)
  title         String                 @db.VarChar(255)
  description   String
  dueDate       DateTime
  maxScore      Decimal                @db.Decimal(5, 2)
  status        String                 @default("active") @db.VarChar(20)
  classId       BigInt?
  subjectId     BigInt?
  teacherId     BigInt
  schoolId      BigInt
  branchId      BigInt?
  courseId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime               @default(now())
  updatedAt     DateTime               @updatedAt
  deletedAt     DateTime?
  class         Class?                 @relation(fields: [classId], references: [id], onDelete: Cascade)
  subject       Subject?               @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  teacher       User                   @relation("Assignment_teacher", fields: [teacherId], references: [id], onDelete: Cascade)
  school        School                 @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?                @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course        Course?                @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser User                   @relation("Assignment_createdByUser", fields: [createdBy], references: [id], onDelete: Cascade)
  updatedByUser User?                  @relation("Assignment_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  attachments   AssignmentAttachment[]
  submissions   AssignmentSubmission[]
  parentNotes   AssignmentParentNote[]

  @@index([classId])
  @@index([subjectId])
  @@index([teacherId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([dueDate])
  @@map("assignments")
}

model AssignmentAttachment {
  id           BigInt     @id @default(autoincrement())
  uuid         String     @unique @default(uuid()) @db.VarChar(36)
  assignmentId BigInt
  name         String     @db.VarChar(255)
  path         String     @db.VarChar(255)
  mimeType     String     @db.VarChar(100)
  size         Int        @default(0)
  schoolId     BigInt
  branchId     BigInt?
  courseId     BigInt?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  deletedAt    DateTime?
  assignment   Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  school       School     @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch       Branch?    @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course       Course?    @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@index([assignmentId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("assignment_attachments")
}

model AssignmentSubmission {
  id           BigInt                 @id @default(autoincrement())
  uuid         String                 @unique @default(uuid()) @db.VarChar(36)
  assignmentId BigInt
  studentId    BigInt
  submittedAt  DateTime
  score        Decimal?               @db.Decimal(5, 2)
  feedback     String?
  schoolId     BigInt
  branchId     BigInt?
  courseId     BigInt?
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  deletedAt    DateTime?
  assignment   Assignment             @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  student      Student                @relation(fields: [studentId], references: [id], onDelete: Cascade)
  school       School                 @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch       Branch?                @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course       Course?                @relation(fields: [courseId], references: [id], onDelete: SetNull)
  attachments  SubmissionAttachment[]

  @@unique([assignmentId, studentId])
  @@index([assignmentId])
  @@index([studentId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("assignment_submissions")
}

model SubmissionAttachment {
  id           BigInt               @id @default(autoincrement())
  uuid         String               @unique @default(uuid()) @db.VarChar(36)
  submissionId BigInt
  name         String               @db.VarChar(255)
  path         String               @db.VarChar(255)
  mimeType     String               @db.VarChar(100)
  size         Int                  @default(0)
  schoolId     BigInt
  branchId     BigInt?
  courseId     BigInt?
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  deletedAt    DateTime?
  submission   AssignmentSubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  school       School               @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch       Branch?              @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course       Course?              @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@index([submissionId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("submission_attachments")
}

model AssignmentParentNote {
  id                  BigInt    @id @default(autoincrement())
  uuid                String    @unique @default(uuid()) @db.VarChar(36)
  assignmentId        BigInt
  note                String
  branchId            BigInt?
  courseId            BigInt?
  teacherResponderId    BigInt?
  studentId           BigInt?
  parentId             BigInt?
  schoolId            BigInt
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  deletedAt            DateTime?
  assignment          Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  parent              Parent?     @relation(fields: [parentId], references: [id], onDelete: Cascade)
  student             Student?   @relation(fields: [studentId], references: [id], onDelete: Cascade)
  teacherResponder    User?      @relation("AssignmentParentNote_teacherResponder", fields: [teacherResponderId], references: [id], onDelete: SetNull)
  school              School     @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch              Branch?    @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course              Course?    @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@index([assignmentId])
  @@index([parentId])
  @@index([studentId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([teacherResponderId])
  @@map("assignment_parent_notes")
}

model SuggestionComplaint {
  id                BigInt                    @id @default(autoincrement())
  uuid              String                    @unique @default(uuid()) @db.VarChar(36)
  parentId          BigInt                    @map("parent_id")
  studentId         BigInt?                   @map("student_id")
  recipientId       BigInt                    @map("recipient_id") // Teacher or Admin who will receive this
  recipientType     RecipientType             @map("recipient_type") // TEACHER or ADMIN
  type              SuggestionComplaintType   // SUGGESTION or COMPLAINT
  title             String                    @db.VarChar(255)
  description       String                    @db.Text
  category          String?                   @db.VarChar(100)
  priority          Priority                  @default(MEDIUM)
  status            SuggestionComplaintStatus @default(SUBMITTED)
  response          String?                   @db.Text
  respondedAt       DateTime?                 @map("responded_at")
  responderId       BigInt?                   @map("responder_id") // Who responded (teacher or admin)
  schoolId          BigInt                    @map("school_id")
  branchId          BigInt?
  courseId          BigInt?
  createdAt         DateTime                  @default(now()) @map("created_at")
  updatedAt         DateTime                  @updatedAt @map("updated_at")
  deletedAt         DateTime?                 @map("deleted_at")
  
  // Relations
  parent            Parent                    @relation(fields: [parentId], references: [id], onDelete: Cascade)
  student           Student?                  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  recipient         User                      @relation("SuggestionComplaint_recipient", fields: [recipientId], references: [id], onDelete: Cascade)
  responder         User?                     @relation("SuggestionComplaint_responder", fields: [responderId], references: [id], onDelete: SetNull)
  school            School                    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch            Branch?                   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course            Course?                   @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@index([parentId])
  @@index([studentId])
  @@index([recipientId])
  @@index([recipientType])
  @@index([type])
  @@index([status])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("suggestion_complaints")
}

model Permission {
  id                   BigInt                 @id @default(autoincrement())
  uuid                 String                 @unique @default(uuid()) @db.VarChar(36)
  name                 String                 @unique @db.VarChar(100)
  description          String?
  action               PermissionAction
  resourceType         ResourceType
  resourceId           String?                @db.VarChar(100)
  scope                PermissionScope        @default(OWN)
  conditions           String?                @db.LongText
  isActive             Boolean                @default(true)
  isSystem             Boolean                @default(false)
  metadata             String?                @db.LongText
  schoolId             BigInt?
  ownerId              BigInt?
  createdBy            BigInt?
  updatedBy            BigInt?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  deletedAt            DateTime?
  school               School?                @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  owner                Owner?                 @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  createdByUser        User?                  @relation("Permission_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser        User?                  @relation("Permission_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  rolePermissions      RolePermission[]
  userPermissions      UserPermission[]
  permissionGroupItems PermissionGroupItem[]
  assignments          PermissionAssignment[]

  @@unique([action, resourceType, resourceId, scope])
  @@index([action])
  @@index([resourceType])
  @@index([scope])
  @@index([isActive])
  @@index([schoolId])
  @@map("permissions")
}

model Role {
  id                    BigInt                 @id @default(autoincrement())
  uuid                  String                 @unique @default(uuid()) @db.VarChar(36)
  name                  String                 @db.VarChar(100)
  description           String?
  type                  UserRole
  isActive              Boolean                @default(true)
  isSystem              Boolean                @default(false)
  isDefault             Boolean                @default(false)
  priority              Int                    @default(0)
  metadata              String?                @db.LongText
  schoolId              BigInt?
  ownerId               BigInt?
  createdBy             BigInt?
  updatedBy             BigInt?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  deletedAt             DateTime?
  school                School?                @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  owner                 Owner?                 @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  createdByUser         User?                  @relation("Role_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser         User?                  @relation("Role_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  rolePermissions       RolePermission[]
  inheritingRoles       RoleInheritance[]      @relation("Role_inheritingRoles")
  parentRoles           RoleInheritance[]      @relation("Role_parentRoles")
  userRoleAssignments   UserRoleAssignment[]
  componentPermissions  ComponentPermission[]
  permissionAssignments PermissionAssignment[]

  @@unique([name, schoolId])
  @@index([isActive])
  @@index([schoolId])
  @@map("roles")
}

model RolePermission {
  id            BigInt     @id @default(autoincrement())
  roleId        BigInt
  permissionId  BigInt
  isGranted     Boolean    @default(true)
  conditions    String?    @db.LongText
  expiresAt     DateTime?
  schoolId      BigInt?
  createdBy     BigInt?
  createdAt     DateTime   @default(now())
  role          Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission    Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  school        School?    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  createdByUser User?      @relation("RolePermission_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
  @@index([isGranted])
  @@index([schoolId])
  @@map("role_permissions")
}

model RoleInheritance {
  id               BigInt   @id @default(autoincrement())
  inheritingRoleId BigInt
  parentRoleId     BigInt
  schoolId         BigInt?
  createdBy        BigInt?
  createdAt        DateTime @default(now())
  inheritingRole   Role     @relation("Role_inheritingRoles", fields: [inheritingRoleId], references: [id], onDelete: Cascade)
  parentRole       Role     @relation("Role_parentRoles", fields: [parentRoleId], references: [id], onDelete: Cascade)
  school           School?  @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  createdByUser    User?    @relation("RoleInheritance_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)

  @@unique([inheritingRoleId, parentRoleId])
  @@index([inheritingRoleId])
  @@index([parentRoleId])
  @@index([schoolId])
  @@map("role_inheritances")
}

model UserPermission {
  id            BigInt     @id @default(autoincrement())
  userId        BigInt
  permissionId  BigInt
  isGranted     Boolean    @default(true)
  conditions    String?    @db.LongText
  expiresAt     DateTime?
  schoolId      BigInt?
  createdBy     BigInt?
  createdAt     DateTime   @default(now())
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  permission    Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  school        School?    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  createdByUser User?      @relation("UserPermission_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)

  @@unique([userId, permissionId])
  @@index([userId])
  @@index([permissionId])
  @@index([isGranted])
  @@index([schoolId])
  @@map("user_permissions")
}

model UserRoleAssignment {
  id             BigInt    @id @default(autoincrement())
  userId         BigInt
  roleId         BigInt
  isActive       Boolean   @default(true)
  assignedAt     DateTime  @default(now())
  expiresAt      DateTime?
  schoolId       BigInt?
  assignedBy     BigInt?
  metadata       String?   @db.LongText
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  role           Role      @relation(fields: [roleId], references: [id], onDelete: Cascade)
  school         School?   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  assignedByUser User?     @relation("UserRoleAssignment_assignedByUser", fields: [assignedBy], references: [id], onDelete: SetNull)

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
  @@index([isActive])
  @@index([schoolId])
  @@map("user_role_assignments")
}

model AccessControlList {
  id            BigInt           @id @default(autoincrement())
  uuid          String           @unique @default(uuid()) @db.VarChar(36)
  name          String           @db.VarChar(100)
  description   String?
  resourceType  ResourceType
  resourceId    String           @db.VarChar(100)
  action        PermissionAction
  principalType String           @db.VarChar(20)
  principalId   BigInt
  isGranted     Boolean          @default(true)
  conditions    String?          @db.LongText
  expiresAt     DateTime?
  schoolId      BigInt?
  createdBy     BigInt?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  createdByUser User?            @relation("AccessControlList_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  school        School?          @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([resourceType, resourceId, action, principalType, principalId])
  @@index([resourceType])
  @@index([resourceId])
  @@index([action])
  @@index([principalType])
  @@index([principalId])
  @@index([isGranted])
  @@index([schoolId])
  @@map("access_control_lists")
}

model PermissionGroup {
  id                   BigInt                @id @default(autoincrement())
  uuid                 String                @unique @default(uuid()) @db.VarChar(36)
  name                 String                @db.VarChar(100)
  description          String?
  isActive             Boolean               @default(true)
  isSystem             Boolean               @default(false)
  metadata             String?               @db.LongText
  schoolId             BigInt?
  ownerId              BigInt?
  createdBy            BigInt?
  updatedBy            BigInt?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  deletedAt            DateTime?
  school               School?               @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  owner                Owner?                @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  createdByUser        User?                 @relation("PermissionGroup_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser        User?                 @relation("PermissionGroup_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  permissionGroupItems PermissionGroupItem[]

  @@index([isActive])
  @@index([schoolId])
  @@map("permission_groups")
}

model PermissionGroupItem {
  id            BigInt          @id @default(autoincrement())
  groupId       BigInt
  permissionId  BigInt
  isGranted     Boolean         @default(true)
  conditions    String?         @db.LongText
  schoolId      BigInt?
  createdBy     BigInt?
  createdAt     DateTime        @default(now())
  group         PermissionGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  permission    Permission      @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  school        School?         @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  createdByUser User?           @relation("PermissionGroupItem_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)

  @@unique([groupId, permissionId])
  @@index([groupId])
  @@index([permissionId])
  @@index([schoolId])
  @@map("permission_group_items")
}

model FrontendComponent {
  id                   BigInt                @id @default(autoincrement())
  uuid                 String                @unique @default(uuid()) @db.VarChar(36)
  name                 String                @unique @db.VarChar(100)
  path                 String                @db.VarChar(255)
  component            String                @db.VarChar(100)
  description          String?
  category             String                @db.VarChar(50)
  isActive             Boolean               @default(true)
  isSystem             Boolean               @default(false)
  metadata             String?               @db.LongText
  schoolId             BigInt?
  ownerId              BigInt?
  createdBy            BigInt?
  updatedBy            BigInt?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  deletedAt            DateTime?
  school               School?               @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  owner                Owner?                @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  createdByUser        User?                 @relation("FrontendComponent_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser        User?                 @relation("FrontendComponent_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  componentPermissions ComponentPermission[]

  @@index([path])
  @@index([component])
  @@index([category])
  @@index([isActive])
  @@index([schoolId])
  @@map("frontend_components")
}

model ComponentPermission {
  id            BigInt            @id @default(autoincrement())
  componentId   BigInt
  roleId        BigInt?
  userId        BigInt?
  permission    String            @db.VarChar(50)
  isGranted     Boolean           @default(true)
  conditions    String?           @db.LongText
  schoolId      BigInt?
  createdBy     BigInt?
  createdAt     DateTime          @default(now())
  component     FrontendComponent @relation(fields: [componentId], references: [id], onDelete: Cascade)
  role          Role?             @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user          User?             @relation(fields: [userId], references: [id], onDelete: Cascade)
  school        School?           @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  createdByUser User?             @relation("ComponentPermission_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)

  @@unique([componentId, roleId, permission])
  @@unique([componentId, userId, permission])
  @@index([componentId])
  @@index([roleId])
  @@index([userId])
  @@index([permission])
  @@index([schoolId])
  @@map("component_permissions")
}

model Policy {
  id                BigInt             @id @default(autoincrement())
  uuid              String             @unique @default(uuid()) @db.VarChar(36)
  name              String             @unique @db.VarChar(100)
  description       String?
  isActive          Boolean            @default(true)
  isSystem          Boolean            @default(false)
  conditions        String             @db.LongText
  effect            String             @default("allow")
  metadata          String?            @db.LongText
  schoolId          BigInt?
  createdBy         BigInt?
  updatedBy         BigInt?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  deletedAt         DateTime?
  createdByUser     User?              @relation("Policy_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser     User?              @relation("Policy_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  school            School?            @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  policyAssignments PolicyAssignment[]

  @@unique([name, deletedAt])
  @@index([isActive])
  @@index([isSystem])
  @@index([createdBy])
  @@index([updatedBy])
  @@index([schoolId])
  @@map("policies")
}

model PolicyAssignment {
  id             BigInt    @id @default(autoincrement())
  policyId       BigInt
  principalType  String    @db.VarChar(20)
  principalId    BigInt
  resourceType   String?   @db.VarChar(50)
  resourceId     String?   @db.VarChar(100)
  isActive       Boolean   @default(true)
  assignedBy     BigInt?
  assignedAt     DateTime  @default(now())
  expiresAt      DateTime?
  metadata       String?   @db.LongText
  schoolId       BigInt?
  policy         Policy    @relation(fields: [policyId], references: [id], onDelete: Cascade)
  school         School?   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  assignedByUser User?     @relation("PolicyAssignment_assignedByUser", fields: [assignedBy], references: [id], onDelete: SetNull)

  @@unique([policyId, principalType, principalId, resourceType, resourceId])
  @@index([principalType])
  @@index([principalId])
  @@index([resourceType])
  @@index([resourceId])
  @@index([isActive])
  @@index([schoolId])
  @@map("policy_assignments")
}

model AttributeRule {
  id                   BigInt                @id @default(autoincrement())
  uuid                 String                @unique @default(uuid()) @db.VarChar(36)
  name                 String                @unique @db.VarChar(100)
  description          String?
  isActive             Boolean               @default(true)
  isSystem             Boolean               @default(false)
  targetType           String                @db.VarChar(50)
  attribute            String                @db.VarChar(100)
  operator             String                @db.VarChar(20)
  value                String                @db.VarChar(255)
  effect               String                @default("allow")
  metadata             String?               @db.LongText
  schoolId             BigInt?
  createdBy            BigInt?
  updatedBy            BigInt?
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  deletedAt            DateTime?
  createdByUser        User?                 @relation("AttributeRule_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser        User?                 @relation("AttributeRule_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  school               School?               @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  attributeAssignments AttributeAssignment[]

  @@unique([name, deletedAt])
  @@index([isActive])
  @@index([isSystem])
  @@index([targetType])
  @@index([attribute])
  @@index([schoolId])
  @@map("attribute_rules")
}

model AttributeAssignment {
  id              BigInt        @id @default(autoincrement())
  attributeRuleId BigInt
  principalType   String        @db.VarChar(20)
  principalId     BigInt
  resourceType    String?       @db.VarChar(50)
  resourceId      String?       @db.VarChar(100)
  isActive        Boolean       @default(true)
  assignedBy      BigInt?
  assignedAt      DateTime      @default(now())
  expiresAt       DateTime?
  metadata        String?       @db.LongText
  schoolId        BigInt?
  attributeRule   AttributeRule @relation(fields: [attributeRuleId], references: [id], onDelete: Cascade)
  school          School?       @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  assignedByUser  User?         @relation("AttributeAssignment_assignedByUser", fields: [assignedBy], references: [id], onDelete: SetNull)

  @@unique([attributeRuleId, principalType, principalId, resourceType, resourceId])
  @@index([principalType])
  @@index([principalId])
  @@index([resourceType])
  @@index([resourceId])
  @@index([isActive])
  @@index([schoolId])
  @@map("attribute_assignments")
}

model Customer {
  id                BigInt                 @id @default(autoincrement())
  uuid              String?                @unique @db.VarChar(36)
  name              String
  serialNumber      String?                @unique @db.VarChar(50)

  phone             String?
  gender            String?                @db.VarChar(20)
  source            String?                @db.VarChar(100)
  purpose           String?                @db.VarChar(255)
  department        String?                @db.VarChar(100)
  referredTo        String?                @db.VarChar(50)
  referredById      BigInt?
  metadata          String?                @db.LongText
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  deletedAt         DateTime?
  ownerId           BigInt?
  schoolId          BigInt?
  createdBy         BigInt?
  updatedBy         BigInt?
  userId            BigInt?
  totalSpent        Decimal?               @db.Decimal(10, 2)
  orderCount        Int?
  type              String?
  pipelineStageId   BigInt?
  rermark           String?                @db.VarChar(255)
  priority          String?                @db.VarChar(255)
  branchId          BigInt?
  referredBy        Customer?              @relation("CustomerReferrals", fields: [referredById], references: [id], onDelete: Restrict, onUpdate: Restrict)
  referrals         Customer[]             @relation("CustomerReferrals")
  owner             Owner?                 @relation(fields: [ownerId], references: [id], onDelete: SetNull)
  school            School?                @relation(fields: [schoolId], references: [id], onDelete: SetNull)
  createdByUser     User?                  @relation("CustomerCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser     User?                  @relation("CustomerUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)
  pipelineStage     CustomerPipelineStage? @relation("CustomerPipelineStageCustomers", fields: [pipelineStageId], references: [id], onDelete: SetNull)
  branch            Branch?                @relation(fields: [branchId], references: [id], onDelete: SetNull)
  payments          Payment[]
  documents         Document[]
  auditLogs         AuditLog[]
  events            CustomerEvent[]
  convertedStudents Student[]              @relation("Student_convertedFromCustomer")

  @@index([schoolId])
  @@index([ownerId])
  @@index([branchId])
  @@index([serialNumber])
  @@index([pipelineStageId])
  @@map("customers")
}

model CustomerPipelineStage {
  id          BigInt     @id @default(autoincrement())
  uuid        String     @unique @default(uuid()) @db.VarChar(36)
  name        String     @db.VarChar(100)
  order       Int
  description String?    @db.VarChar(255)
  color       String?    @db.VarChar(20)
  schoolId    BigInt
  branchId    BigInt?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  deletedAt   DateTime?
  school      School     @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch      Branch?    @relation(fields: [branchId], references: [id], onDelete: SetNull)
  customers   Customer[] @relation("CustomerPipelineStageCustomers")

  @@unique([schoolId, name])
  @@index([schoolId])
  @@index([branchId])
  @@index([order])
  @@map("customer_pipeline_stages")
}

model CustomerEvent {
  id            BigInt   @id @default(autoincrement())
  uuid          String   @unique @default(uuid()) @db.VarChar(36)
  customerId    BigInt
  eventType     String   @db.VarChar(100)
  title         String   @db.VarChar(255)
  description   String?
  metadata      String?  @db.LongText
  severity      String   @default("INFO") @db.VarChar(20)
  schoolId      BigInt
  branchId      BigInt?
  createdBy     BigInt?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  customer      Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  school        School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?  @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User?    @relation("CustomerEvent_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)

  @@index([customerId])
  @@index([eventType])
  @@index([severity])
  @@index([schoolId])
  @@index([branchId])
  @@index([createdAt])
  @@map("customer_events")
}

model StudentEvent {
  id            BigInt   @id @default(autoincrement())
  uuid          String   @unique @default(uuid()) @db.VarChar(36)
  studentId     BigInt
  eventType     String   @db.VarChar(100)
  title         String   @db.VarChar(255)
  description   String?
  metadata      String?  @db.LongText
  severity      String   @default("INFO") @db.VarChar(20)
  schoolId      BigInt
  branchId      BigInt?
  courseId      BigInt?
  createdBy     BigInt?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  student       Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  school        School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch?  @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course        Course?  @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser User?    @relation("StudentEvent_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)

  @@index([studentId])
  @@index([eventType])
  @@index([severity])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@index([createdAt])
  @@map("student_events")
}

model Notification {
  id           BigInt                   @id @default(autoincrement())
  uuid         String                   @unique @default(uuid()) @db.VarChar(36)
  type         String                   @db.VarChar(100)
  category     String?                  @db.VarChar(50)
  subType      String?                  @db.VarChar(100)
  title        String                   @db.VarChar(255)
  message      String
  summary      String?                  @db.VarChar(500)
  priority     String                   @default("NORMAL") @db.VarChar(20)
  status       String                   @default("PENDING") @db.VarChar(20)
  metadata     String?                  @db.LongText
  actions      String?                  @db.LongText
  expiresAt    DateTime?
  scheduledAt  DateTime?
  entityType   String?                  @db.VarChar(50)
  entityId     BigInt?
  entityAction String?                  @db.VarChar(50)
  senderId     BigInt?
  schoolId     BigInt
  branchId     BigInt?
  ownerId      BigInt?
  audienceRoles String?                 @db.LongText
  contextScope String?                  @db.VarChar(100)
  source        String?                 @db.VarChar(100)
  templateKey  String?                  @db.VarChar(100)
  templateData String?                  @db.LongText
  createdAt    DateTime                 @default(now())
  updatedAt    DateTime                 @updatedAt
  deletedAt    DateTime?
  sender       User?                    @relation("Notification_sender", fields: [senderId], references: [id], onDelete: SetNull)
  school       School                   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch       Branch?                  @relation(fields: [branchId], references: [id], onDelete: SetNull)
  owner        Owner?                   @relation(fields: [ownerId], references: [id], onDelete: SetNull)
  recipients   NotificationRecipient[]
  attachments  NotificationAttachment[]
  deliveries   NotificationDelivery[]

  @@index([type])
  @@index([category])
  @@index([subType])
  @@index([priority])
  @@index([status])
  @@index([schoolId])
  @@index([branchId])
  @@index([entityType])
  @@index([entityId])
  @@index([createdAt])
  @@index([scheduledAt])
  @@index([contextScope])
  @@index([source])
  @@map("notifications")
}

model NotificationRecipient {
  id             BigInt       @id @default(autoincrement())
  uuid           String       @unique @default(uuid()) @db.VarChar(36)
  notificationId BigInt
  userId         BigInt
  channel        String       @db.VarChar(20)
  status         String       @default("PENDING") @db.VarChar(20)
  readAt         DateTime?
  firstViewedAt  DateTime?
  acknowledgedAt DateTime?
  dismissedAt    DateTime?
  actionRequired Boolean      @default(false)
  followUpAt     DateTime?
  deliveredAt    DateTime?
  metadata       String?      @db.LongText
  notes          String?      @db.LongText
  branchId       BigInt?      @map("branchId")
  courseId       BigInt?      @map("courseId")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  branch         Branch?      @relation("BranchNotificationRecipients", fields: [branchId], references: [id], onDelete: SetNull)
  course         Course?      @relation("CourseNotificationRecipients", fields: [courseId], references: [id], onDelete: SetNull)

  @@unique([notificationId, userId, channel])
  @@index([notificationId])
  @@index([userId])
  @@index([channel])
  @@index([status])
  @@index([actionRequired])
  @@index([followUpAt])
  @@index([branchId])
  @@index([courseId])
  @@map("notification_recipients")
}

model NotificationAttachment {
  id             BigInt       @id @default(autoincrement())
  uuid           String       @unique @default(uuid()) @db.VarChar(36)
  notificationId BigInt
  name           String       @db.VarChar(255)
  url            String
  type           String       @db.VarChar(50)
  size           Int?
  mimeType       String?      @db.VarChar(100)
  description    String?
  branchId       BigInt?      @map("branchId")
  courseId       BigInt?      @map("courseId")
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  notification   Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  branch         Branch?      @relation("BranchNotificationAttachments", fields: [branchId], references: [id], onDelete: SetNull)
  course         Course?      @relation("CourseNotificationAttachments", fields: [courseId], references: [id], onDelete: SetNull)

  @@index([notificationId])
  @@index([type])
  @@index([branchId])
  @@index([courseId])
  @@map("notification_attachments")
}

model NotificationDelivery {
  id              BigInt       @id @default(autoincrement())
  uuid            String       @unique @default(uuid()) @db.VarChar(36)
  notificationId  BigInt
  channel         String       @db.VarChar(20)
  status          String       @db.VarChar(20)
  attemptCount    Int          @default(0)
  deliveredAt     DateTime?
  errorMessage    String?
  lastErrorAt     DateTime?
  gatewayResponse String?      @db.LongText
  metadata        String?      @db.LongText
  branchId        BigInt?      @map("branchId")
  courseId        BigInt?      @map("courseId")
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  notification    Notification @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  branch          Branch?      @relation("BranchNotificationDeliveries", fields: [branchId], references: [id], onDelete: SetNull)
  course          Course?      @relation("CourseNotificationDeliveries", fields: [courseId], references: [id], onDelete: SetNull)

  @@index([notificationId])
  @@index([channel])
  @@index([status])
  @@index([branchId])
  @@index([courseId])
  @@index([createdAt])
  @@map("notification_deliveries")
}

model NotificationTemplate {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  key           String    @unique @db.VarChar(100)
  name          String    @db.VarChar(255)
  description   String?
  type          String    @db.VarChar(50)
  subject       String?   @db.VarChar(255)
  body          String
  htmlBody      String?
  variables     String?   @db.LongText
  isActive      Boolean   @default(true)
  isSystem      Boolean   @default(false)
  schoolId      BigInt?
  branchId      BigInt?
  createdBy     BigInt?
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  school        School?   @relation(fields: [schoolId], references: [id], onDelete: SetNull)
  branch        Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User?     @relation("NotificationTemplate_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser User?     @relation("NotificationTemplate_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([key])
  @@index([type])
  @@index([isActive])
  @@index([schoolId])
  @@index([branchId])
  @@map("notification_templates")
}

model NotificationRule {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  name          String    @db.VarChar(255)
  description   String?
  entityType    String    @db.VarChar(50)
  eventType     String    @db.VarChar(100)
  conditions    String?   @db.LongText
  templateKey   String?   @db.VarChar(100)
  channels      String?   @db.LongText
  recipients    String?   @db.LongText
  isActive      Boolean   @default(true)
  isSystem      Boolean   @default(false)
  schoolId      BigInt?
  branchId      BigInt?
  createdBy     BigInt?
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?
  school        School?   @relation(fields: [schoolId], references: [id], onDelete: SetNull)
  branch        Branch?   @relation(fields: [branchId], references: [id], onDelete: SetNull)
  createdByUser User?     @relation("NotificationRule_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser User?     @relation("NotificationRule_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([entityType])
  @@index([eventType])
  @@index([isActive])
  @@index([schoolId])
  @@index([branchId])
  @@map("notification_rules")
}

model PermissionAssignment {
  id             BigInt     @id @default(autoincrement())
  uuid           String     @unique @default(uuid()) @db.VarChar(36)
  userId         BigInt?
  roleId         BigInt?
  groupId        BigInt?
  permissionId   BigInt
  scope          String     @default("global")
  resource       String?
  action         String?
  conditions     String?    @db.LongText
  priority       Int        @default(1)
  isActive       Boolean    @default(true)
  expiresAt      DateTime?
  assignedBy     BigInt?
  assignedAt     DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  schoolId       BigInt?
  user           User?      @relation(fields: [userId], references: [id])
  role           Role?      @relation(fields: [roleId], references: [id])
  group          Group?     @relation(fields: [groupId], references: [id])
  permission     Permission @relation(fields: [permissionId], references: [id])
  school         School?    @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  assignedByUser User?      @relation("PermissionAssignment_assignedByUser", fields: [assignedBy], references: [id], onDelete: SetNull)

  @@unique([userId, roleId, groupId, permissionId, scope, resource, action])
  @@index([userId])
  @@index([roleId])
  @@index([groupId])
  @@index([permissionId])
  @@index([scope])
  @@index([isActive])
  @@index([schoolId])
  @@map("permission_assignments")
}

model Group {
  id                    BigInt                 @id @default(autoincrement())
  uuid                  String                 @unique @default(uuid()) @db.VarChar(36)
  name                  String                 @unique @db.VarChar(100)
  description           String?
  type                  String                 @db.VarChar(50)
  isActive              Boolean                @default(true)
  metadata              String?                @db.LongText
  schoolId              BigInt?
  branchId              BigInt?
  ownerId               BigInt?
  createdBy             BigInt?
  updatedBy             BigInt?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  deletedAt             DateTime?
  school                School?                @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch                Branch?                @relation(fields: [branchId], references: [id], onDelete: SetNull)
  owner                 Owner?                 @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  createdByUser         User?                  @relation("Group_createdByUser", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser         User?                  @relation("Group_updatedByUser", fields: [updatedBy], references: [id], onDelete: SetNull)
  users                 User[]
  permissionAssignments PermissionAssignment[]

  @@index([name])
  @@index([type])
  @@index([isActive])
  @@index([schoolId])
  @@index([branchId])
  @@map("groups")
}

model ClassToSubject {
  A BigInt
  B BigInt
  schoolId BigInt?
  school   School? @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([A, B], map: "_ClassToSubject_AB_unique")
  @@index([B], map: "_ClassToSubject_B_index")
  @@index([schoolId])
  @@map("_ClassToSubject")
}

model GroupToUser {
  A BigInt
  B BigInt
  schoolId BigInt?
  school   School? @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([A, B], map: "_GroupToUser_AB_unique")
  @@index([B], map: "_GroupToUser_B_index")
  @@index([schoolId])
  @@map("_GroupToUser")
}

model Participant_lastReadMessage {
  A BigInt
  B BigInt
  schoolId BigInt?
  school   School? @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([A, B], map: "_Participant_lastReadMessage_AB_unique")
  @@index([B], map: "_Participant_lastReadMessage_B_index")
  @@index([schoolId])
  @@map("_Participant_lastReadMessage")
}

model SubjectToTeacher {
  A BigInt
  B BigInt
  schoolId BigInt?
  school   School? @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@unique([A, B], map: "_SubjectToTeacher_AB_unique")
  @@index([B], map: "_SubjectToTeacher_B_index")
  @@index([schoolId])
  @@map("_SubjectToTeacher")
}

model ClassToTeacher {
  id        BigInt   @id @default(autoincrement())
  classId   BigInt
  teacherId BigInt
  schoolId  BigInt
  branchId  BigInt?
  courseId  BigInt?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  class    Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  teacher  Teacher  @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  school   School   @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch   Branch?  @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course   Course?  @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@unique([classId, teacherId], map: "_ClassToTeacher_AB_unique")
  @@index([classId], map: "_ClassToTeacher_A_index")
  @@index([teacherId], map: "_ClassToTeacher_B_index")
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("class_teachers")
}

model TeacherClassSubject {
  id                BigInt           @id @default(autoincrement())
  teacherId         BigInt
  classId           BigInt
  subjectId         BigInt
  academicSessionId BigInt?
  schoolId          BigInt
  branchId          BigInt?
  courseId          BigInt?
  isActive          Boolean          @default(true)
  assignedBy        BigInt
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  deletedAt         DateTime?

  teacher         Teacher          @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  class           Class            @relation(fields: [classId], references: [id], onDelete: Cascade)
  subject         Subject          @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  academicSession AcademicSession? @relation(fields: [academicSessionId], references: [id], onDelete: SetNull)
  school          School           @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch          Branch?          @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course          Course?          @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@unique([teacherId, classId, subjectId, academicSessionId], map: "teacher_class_subject_session_unique")
  @@index([teacherId])
  @@index([classId])
  @@index([subjectId])
  @@index([academicSessionId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("teacher_class_subjects")
}

model GoogleDriveIntegration {
  id           BigInt   @id @default(autoincrement())
  uuid         String   @unique @default(uuid()) @db.VarChar(36)
  userId       BigInt   @unique
  accessToken  String   @db.Text
  refreshToken String?  @db.Text
  tokenExpiry  DateTime?
  email        String?  @db.VarChar(255)
  name         String?  @db.VarChar(255)
  picture      String?  @db.VarChar(500)
  scope        String?  @db.Text
  isActive     Boolean  @default(true)
  lastSyncedAt DateTime?
  schoolId     BigInt?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  deletedAt    DateTime?
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  school       School?  @relation(fields: [schoolId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isActive])
  @@index([schoolId])
  @@map("google_drive_integrations")
}

model BookDistribution {
  id             BigInt    @id @default(autoincrement())
  uuid           String    @unique @default(uuid()) @db.VarChar(36)
  studentId      BigInt
  subjectId      BigInt
  bookName       String    @db.VarChar(255)
  distributedDate DateTime @default(now())
  returned       Boolean   @default(false)
  returnedDate   DateTime?
  condition      String?   @db.VarChar(100)
  remarks        String?   @db.VarChar(500)
  schoolId       BigInt
  branchId       BigInt?
  courseId       BigInt?
  createdBy      BigInt
  updatedBy      BigInt?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  deletedAt      DateTime?

  student       Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
  subject       Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  school        School  @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch? @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course        Course? @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser User    @relation("BookDistribution_createdByUser", fields: [createdBy], references: [id])
  updatedByUser User?   @relation("BookDistribution_updatedByUser", fields: [updatedBy], references: [id])

  @@index([studentId])
  @@index([subjectId])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("book_distributions")
}

model GradeApproval {
  id            BigInt    @id @default(autoincrement())
  uuid          String    @unique @default(uuid()) @db.VarChar(36)
  classId       BigInt
  examType      ExamType
  approvalLevel Int       // 1-10 for 10 signature levels
  approverName  String    @db.VarChar(255)
  approverTitle String    @db.VarChar(255) // نگران صنف, مدیر تدریسی, etc.
  signature     String?   @db.Text // Digital signature or upload path
  approvalDate  DateTime?
  status        String    @default("PENDING") @db.VarChar(20) // PENDING, APPROVED, REJECTED
  comments      String?   @db.Text
  schoolId      BigInt
  branchId      BigInt?
  courseId      BigInt?
  createdBy     BigInt
  updatedBy     BigInt?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  deletedAt     DateTime?

  class         Class  @relation(fields: [classId], references: [id], onDelete: Cascade)
  school        School @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  branch        Branch? @relation(fields: [branchId], references: [id], onDelete: SetNull)
  course        Course? @relation(fields: [courseId], references: [id], onDelete: SetNull)
  createdByUser User   @relation("GradeApproval_createdByUser", fields: [createdBy], references: [id])
  updatedByUser User?  @relation("GradeApproval_updatedByUser", fields: [updatedBy], references: [id])

  @@unique([classId, examType, approvalLevel])
  @@index([classId])
  @@index([examType])
  @@index([status])
  @@index([schoolId])
  @@index([branchId])
  @@index([courseId])
  @@map("grade_approvals")
}

enum UserRole {
  SUPER_ADMIN
  SUPER_DUPER_ADMIN
  SCHOOL_ADMIN
  TEACHER
  STUDENT
  STAFF
  HRM
  PARENT
  ACCOUNTANT
  LIBRARIAN
  CRM_MANAGER
  BRANCH_MANAGER
  COURSE_MANAGER
}

enum Gender {
  MALE
  FEMALE
  OTHER
  PREFER_NOT_TO_SAY
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
  HALF_DAY
}

enum PaymentStatus {
  PAID
  UNPAID
  PARTIALLY_PAID
  OVERDUE
  CANCELLED
  REFUNDED
  PENDING
}

enum PaymentMethod {
  CASH
  CARD
  BANK_TRANSFER
  MOBILE_PAYMENT
  CHECK
  SCHOLARSHIP
}

enum ExamType {
  MIDTERM
  FINAL
  QUIZ
  ASSIGNMENT
  PROJECT
  PRACTICAL
}

enum TermType {
  FIRST_TERM
  SECOND_TERM
  THIRD_TERM
  SUMMER
  WINTER
}

enum CourseType {
  CORE
  ELECTIVE
  ENRICHMENT
  REMEDIAL
  EXTRACURRICULAR
  ONLINE
}

enum EnrollmentStatus {
  ENROLLED
  PROMOTED
  COMPLETED
  WITHDRAWN
  REPEATED
  TRANSFERRED
}

enum BranchStatus {
  ACTIVE
  INACTIVE
  ARCHIVED
}

enum SchoolStatus {
  ACTIVE
  INACTIVE
  PENDING
  SUSPENDED
  DEACTIVATED
}

enum SubscriptionStatus {
  ACTIVE
  SUSPENDED
  CANCELLED
  EXPIRED
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  GRADUATED
  TRANSFERRED
}

enum DocumentType {
  ID_PROOF
  ADDRESS_PROOF
  BIRTH_CERTIFICATE
  TRANSFER_CERTIFICATE
  MARKSHEET
  PHOTOGRAPH
  MEDICAL_CERTIFICATE
  OTHER
}

enum PermissionAction {
  CREATE
  READ
  UPDATE
  DELETE
  APPROVE
  REJECT
  EXPORT
  IMPORT
  BULK_OPERATION
  VIEW_REPORTS
  MANAGE_USERS
  MANAGE_ROLES
  MANAGE_PERMISSIONS
  SYSTEM_ADMIN
}

enum ResourceType {
  STUDENT
  TEACHER
  CLASS
  SUBJECT
  EXAM
  GRADE
  ATTENDANCE
  ASSIGNMENT
  ACADEMIC_SESSION
  TERM
  SECTION
  DEPARTMENT
  PAYMENT
  FEE_STRUCTURE
  FEE_ITEM
  REFUND
  INSTALLMENT
  PAYROLL
  INCOME
  BILL
  USER
  ROLE
  PERMISSION
  SCHOOL
  OWNER
  STAFF
  PARENT
  ACCOUNTANT
  LIBRARIAN
  BOOK
  BOOK_ISSUE
  BOOK_RESERVATION
  BOOK_REVIEW
  INVENTORY_ITEM
  INVENTORY_CATEGORY
  INVENTORY_SUPPLIER
  PURCHASE_ORDER
  INVENTORY_LOG
  INVENTORY_MAINTENANCE
  VEHICLE
  ROUTE
  TRIP
  STUDENT_TRANSPORT
  TRANSPORT_ATTENDANCE
  FACILITY
  FACILITY_BOOKING
  NOTICE
  EVENT
  MESSAGE
  NOTIFICATION
  DOCUMENT
  CUSTOMER
  CUSTOMER_PIPELINE
  SYSTEM_SETTING
  SCHOOL_SETTING
  AUDIT_LOG
  FILE
  TIMETABLE
  TIMETABLE_VERSION
  DASHBOARD
  REPORTS
  ANALYTICS
  SETTINGS
  PROFILE
  NOTIFICATIONS
  HELP
  ABOUT
}

enum PermissionScope {
  OWN
  SCHOOL
  ALL
  CUSTOM
}

enum MessageType {
  DIRECT
  GROUP
  BROADCAST
  ANNOUNCEMENT
  SYSTEM
  NOTIFICATION
  ALERT
  REMINDER
  SCHEDULED
  ENCRYPTED
  VOICE
  VIDEO
  FILE
  LOCATION
  POLL
  REACTION
  THREAD
  REPLY
  FORWARD
  ARCHIVE
}

enum MessagePriority {
  LOW
  NORMAL
  HIGH
  URGENT
  CRITICAL
}

enum MessageStatus {
  DRAFT
  SENT
  DELIVERED
  READ
  FAILED
  PENDING
  SCHEDULED
  CANCELLED
  ARCHIVED
  DELETED
}

enum ConversationType {
  DIRECT
  GROUP
  CHANNEL
  BROADCAST
  ANNOUNCEMENT
  SUPPORT
  MODERATION
}

enum AttachmentType {
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
  PDF
  SPREADSHEET
  PRESENTATION
  ARCHIVE
  LOCATION
  CONTACT
  CALENDAR
  CODE
  OTHER
}

enum EncryptionType {
  NONE
  AES_256
  END_TO_END
  ENTERPRISE
  QUANTUM_SAFE
}

enum MessageReactionType {
  LIKE
  LOVE
  HAHA
  WOW
  SAD
  ANGRY
  THUMBS_UP
  THUMBS_DOWN
  CLAP
  HEART
  FIRE
  ROCKET
  EYES
  PRAY
  CELEBRATE
}

enum RecipientType {
  TEACHER
  ADMIN
}

enum SuggestionComplaintType {
  SUGGESTION
  COMPLAINT
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum SuggestionComplaintStatus {
  SUBMITTED
  UNDER_REVIEW
  RESPONDED
  RESOLVED
  CLOSED
}

enum SMSStatus {
  PENDING
  SENT
  FAILED
  NOT_SENT
  NO_PHONE
}

enum SMSSource {
  AUTO     // Automatically sent by mark-in/mark-out endpoint
  MANUAL   // Manually sent via resend button
}
    